{
  "hash": "58127ff99f0cf093264a1cafd2689e21",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"OPTIONAL practice problem - everything is a linear model\"\neditor: source\nfreeze: auto\ndate: 2024-05-01\ndate-modified: last-modified\n---\n\n\n## Description\n\nLinear models share the same parametric base as ANOVAs (and t-tests!). This means that if you were to compare your results from an ANOVA to a linear model, you would see the same result.  \n\nHowever, the presentation of those results is slightly different, so it's not always obvious if you're just looking at R output. For example, with a linear model, you would see the estimates for each level of a factor relative to a reference level. Compare this with an ANOVA, where you would see sum of squares, mean squares, F-statistic, and p-value.  \n\nProve to yourself that ANOVAs are actually just linear models!\n\n## Set up\n\nInstall `palmerpenguins` if you don't have it already. Read in the data using `data(penguins)`.  \n\nThe question we will ask is: [**How does body mass differ between penguin species?**]{style=\"color: #008080;\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(palmerpenguins)\nlibrary(car)\nlibrary(ggeffects)\n\ndata(penguins)\n```\n:::\n\n\n\n## Problem\n\n### 1. Calculate the mean body masses and lower and upper bounds of the 95% CI around the mean for each penguins species.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins %>% \n  group_by(species) %>% # group by species\n  reframe(mean = mean(body_mass_g, na.rm = TRUE), # calculating mean\n          se = sd(body_mass_g, na.rm = TRUE)/sqrt(length(body_mass_g)), # calculating SE\n          tval = qt(p = 0.05/2, df = length(body_mass_g), lower.tail = FALSE), # finding t-value\n          margin = se*tval, # calculating margin of error\n          conf_low = mean - margin, # calculating the lower bound of the CI\n          conf_high = mean + margin, # calculating the upper bound of the CI\n          var = var(body_mass_g, na.rm = TRUE) # also calculating variance here for efficiency\n          ) \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 Ã— 8\n  species    mean    se  tval margin conf_low conf_high     var\n  <fct>     <dbl> <dbl> <dbl>  <dbl>    <dbl>     <dbl>   <dbl>\n1 Adelie    3701.  37.2  1.98   73.5    3627.     3774. 210283.\n2 Chinstrap 3733.  46.6  2.00   93.0    3640.     3826. 147713.\n3 Gentoo    5076.  45.3  1.98   89.6    4986.     5166. 254133.\n```\n\n\n:::\n:::\n\n\n:::{.callout-note}\nStop and think: keep in mind what those means and 95% CI around the means are!\n:::\n\n### 2. Create a figure with species on the x-axis and body mass on the y-axis, with means, 95% CIs, and the underlying data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = penguins, # penguins data\n       aes(x = species, # x-axis\n           y = body_mass_g)) + # y-axis\n  geom_point(position = position_jitter(width = 0.2, # shake points left and right\n                                        height = 0), # not up and down\n             alpha = 0.2) + # transparency\n  stat_summary(geom = \"pointrange\", # plot means and CIs\n               fun.data = mean_cl_normal) # calculating mean and 95% confidence interval\n```\n\n::: {.cell-output-display}\n![](optional-problem-05_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n:::{.callout-note}\nStop and think: do you think there's a difference between species in body mass?\n:::\n\n### 3. Use ANOVA to determine the difference in body mass between penguin species.  \n\nDo any assumption checks as needed.  \n\nFirst, Levene's test:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nleveneTest(body_mass_g ~ species, # formula\n           data = penguins) # data\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nLevene's Test for Homogeneity of Variance (center = median)\n       Df F value   Pr(>F)   \ngroup   2  5.1203 0.006445 **\n      339                    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n\nSignificantly different variances in body mass between species! But looking at the calculated variances, they are for practical purposes equal.  \n\nVisually evaluating normality:  \n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = penguins,\n       aes(sample = body_mass_g)) + # argument for a QQ plot\n  geom_qq_line(lty = 2, \n               color = \"grey\") + # adding a reference line\n  geom_qq() + # QQ\n  theme_classic() + # cleaner background, easier to see things\n  facet_wrap(~species)\n```\n\n::: {.cell-output-display}\n![](optional-problem-05_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\nStatistically evaluating normality:   \n\n\n::: {.cell}\n\n```{.r .cell-code}\nadelie <- penguins %>% \n  filter(species == \"Adelie\") %>% # filtering for Adelie\n  pull(body_mass_g) # pulling body mass as a vector\n\nshapiro.test(adelie)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tShapiro-Wilk normality test\n\ndata:  adelie\nW = 0.98071, p-value = 0.0324\n```\n\n\n:::\n\n```{.r .cell-code}\nchinstrap <- penguins %>% \n  filter(species == \"Chinstrap\") %>% # filtering for chinstrap\n  pull(body_mass_g)\n\nshapiro.test(chinstrap)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tShapiro-Wilk normality test\n\ndata:  chinstrap\nW = 0.98449, p-value = 0.5605\n```\n\n\n:::\n\n```{.r .cell-code}\ngentoo <- penguins %>% \n  filter(species == \"Gentoo\") %>% # filtering for Gentoo\n  pull(body_mass_g)\n\nshapiro.test(gentoo)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tShapiro-Wilk normality test\n\ndata:  gentoo\nW = 0.98593, p-value = 0.2336\n```\n\n\n:::\n:::\n\n\nProbably ok.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins_anova <- aov(body_mass_g ~ species, # formula\n                      data = penguins) # data\n\n# show the ANOVA table: sums of squares, mean squares, f-statistic, p-value\nsummary(penguins_anova)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n             Df    Sum Sq  Mean Sq F value Pr(>F)    \nspecies       2 146864214 73432107   343.6 <2e-16 ***\nResiduals   339  72443483   213698                   \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n2 observations deleted due to missingness\n```\n\n\n:::\n:::\n\n\n:::{.callout-note}\nStop and think: what is the result of your ANOVA?\n:::\n\nThen, do a post-hoc:  \n\n\n::: {.cell}\n\n```{.r .cell-code}\nTukeyHSD(penguins_anova)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  Tukey multiple comparisons of means\n    95% family-wise confidence level\n\nFit: aov(formula = body_mass_g ~ species, data = penguins)\n\n$species\n                       diff       lwr       upr     p adj\nChinstrap-Adelie   32.42598 -126.5002  191.3522 0.8806666\nGentoo-Adelie    1375.35401 1243.1786 1507.5294 0.0000000\nGentoo-Chinstrap 1342.92802 1178.4810 1507.3750 0.0000000\n```\n\n\n:::\n:::\n\n\n:::{.callout-note}\nStop and think: what is the result of your post-hoc test?\n:::\n\n### 4. Use a linear model to determine the difference in body mass between penguin species.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins_lm <- lm(body_mass_g ~ species,\n                  data = penguins)\n\npar(mfrow = c(2, 2)) # displaying all diagnostic plots in 2x2 grid\nplot(penguins_lm) # diagnostic plots\n```\n\n::: {.cell-output-display}\n![](optional-problem-05_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n\n```{.r .cell-code}\nsummary(penguins_lm) # model estimates and information\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = body_mass_g ~ species, data = penguins)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-1126.02  -333.09   -33.09   316.91  1223.98 \n\nCoefficients:\n                 Estimate Std. Error t value Pr(>|t|)    \n(Intercept)       3700.66      37.62   98.37   <2e-16 ***\nspeciesChinstrap    32.43      67.51    0.48    0.631    \nspeciesGentoo     1375.35      56.15   24.50   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 462.3 on 339 degrees of freedom\n  (2 observations deleted due to missingness)\nMultiple R-squared:  0.6697,\tAdjusted R-squared:  0.6677 \nF-statistic: 343.6 on 2 and 339 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n:::\n\n\n:::{.callout-note}\n\nStop and think about this result.\n\n- How do the estimates compare to your calculated means?  \n- How do the F-statistic, degrees of freedom, and p-value for the model compare to the ANOVA summary?  \n- What components of the ANOVA summary go into the R^2^?  \n\n:::\n\nThen, get the model predictions:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggpredict(penguins_lm, \n          terms = c(\"species\")) # only predictor in the model is species\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# Predicted values of body_mass_g\n\nspecies   | Predicted |           95% CI\n----------------------------------------\nAdelie    |   3700.66 | 3626.67, 3774.66\nChinstrap |   3733.09 | 3622.82, 3843.36\nGentoo    |   5076.02 | 4994.03, 5158.00\n```\n\n\n:::\n:::\n\n\n:::{.callout-note}\nStop and think: compare these with your calculated means and 95% CIs.\n:::\n\nThen, plot for good measure!\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggpredict(penguins_lm, # getting model predictions\n          terms = c(\"species\")) %>% # only predictor is species\n  # quick option to plot from ggpredict\n  plot(show_data = TRUE, # show the underlying data\n       jitter = TRUE) # shake the points around a bit\n```\n\n::: {.cell-output-display}\n![](optional-problem-05_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "optional-problem-05_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}