{
  "hash": "d3fe1c05b86ea31b89691b96c3d86c1b",
  "result": {
    "markdown": "---\ntitle: \"Lecture 06 figures\"\neditor: source\nfreeze: auto\nauthor:\n  - name: An Bui\n    url: https://an-bui.com/\n    affiliation: UC Santa Barbara, Ecology, Evolution, and Marine Biology\n    affiliation-url: https://www.eemb.ucsb.edu/\ndate: 2023-05-08\ncategories: [chi-square, ANOVA, shapiro-wilk, levene, kruskal-wallis, cliff's delta, eta squared]\ncitation:\n  url: https://an-bui.github.io/ES-193DS-W23/lecture/lecture-06_2023-05-08.html\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(palmerpenguins)\nlibrary(showtext)\nlibrary(car)\nfont_add_google(\"Lato\", \"Lato\")\nshowtext_auto()\nlibrary(patchwork)\n```\n:::\n\n\n## Chi-square\n\n### test statistic:\n\n$$\n\\chi^2 = \\Sigma\\frac{(O-E)^2}{E}\n$$\n### degrees of freedom\n$$\ndf = (number\\;of\\;rows - 1) * (number\\;of\\;columns - 1)\n$$\n\n### expected counts:\n$$\nexpected = \\frac{row\\;total * column\\;total}{table\\;total}\n$$\n\n### expected counts example from lecture\n$$\n\\frac{126 * 118}{315} = 47.2\n$$\n\n### test statistic calculation example from lecture\n$$\n\\begin{align}\n\\chi^2 &= \\Sigma\\frac{(O-E)^2}{E} \\\\\n\\chi^2 &= \\frac{55-47.2}{47.2}+...+\\frac{45-31.9}{31.9} \\\\\n&= 15.276\n\\end{align}\n$$\n\n### example code\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# create matrix\nsurvey <- tribble(\n  ~distance, ~trails, ~dog_access, ~wildlife_habitat,\n  \"walking_distance\", 55, 38, 33,\n  \"driving_distance\", 41, 25, 29,\n  \"out_of_town\", 22, 27, 45\n) %>% \n  column_to_rownames(\"distance\")\n\nsurvey\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                 trails dog_access wildlife_habitat\nwalking_distance     55         38               33\ndriving_distance     41         25               29\nout_of_town          22         27               45\n```\n:::\n\n```{.r .cell-code}\n# calculate proportions\nsurvey_summary <- tribble(\n  ~distance, ~trails, ~dog_access, ~wildlife_habitat,\n  \"walking_distance\", 55, 38, 33,\n  \"driving_distance\", 41, 25, 29,\n  \"out_of_town\", 22, 27, 45\n) %>% \n  pivot_longer(cols = trails:wildlife_habitat, names_to = \"responses\", values_to = \"counts\") %>% \n  group_by(distance) %>% \n  mutate(sum = sum(counts)) %>% \n  ungroup() %>% \n  mutate(prop = counts/sum)\n  \n# do chi-square\nchisq.test(survey)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tPearson's Chi-squared test\n\ndata:  survey\nX-squared = 15.276, df = 4, p-value = 0.004162\n```\n:::\n\n```{.r .cell-code}\n# get expected matrix\nchisq.test(survey)$expected\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                  trails dog_access wildlife_habitat\nwalking_distance 47.2000   36.00000         42.80000\ndriving_distance 35.5873   27.14286         32.26984\nout_of_town      35.2127   26.85714         31.93016\n```\n:::\n:::\n\n\n# ANOVA\n\n## ANOVA variance figure:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncol1 <- \"cornflowerblue\"\ncol2 <- \"orange\"\ncol3 <- \"darkgreen\"\n\nggplot(data.frame(x = 0:22), aes(x)) +\n  stat_function(geom = \"line\", n = 100, fun = dnorm, args = list(mean = 10, sd = 2), linewidth = 1, col = col1) + \n  stat_function(geom = \"line\", n = 100, fun = dnorm, args = list(mean = 8, sd = 2), linewidth = 1, col = col2) +\n  stat_function(geom = \"line\", n = 100, fun = dnorm, args = list(mean = 15, sd = 2), linewidth = 1, col = col3) +\n  theme_bw() +\n  theme(panel.grid = element_blank(),\n        axis.text = element_blank(),\n        axis.title = element_blank(),\n        axis.ticks = element_blank(),\n        panel.border = element_blank(),\n        text = element_text(family = \"Lato\")) \n```\n\n::: {.cell-output-display}\n![](lecture-06_2023-05-08_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n\n## ANOVA with palmer penguins\n\n::: {.cell}\n\n```{.r .cell-code}\n# Adelie: 10\n# Chinstrap: 8\n# Gentoo: 10\n\nadelie <- penguins %>% \n  filter(species == \"Adelie\")\n\nadelie_hist <- ggplot(data = adelie, aes(x = bill_length_mm)) +\n  geom_histogram(bins = 10, fill = col1, color = col1, alpha = 0.8) +\n  labs(x = \"Bill length (mm)\", y = \"Count\") +\n  theme_bw() +\n  theme(panel.grid = element_blank(),\n        axis.text = element_text(size = 18),\n        axis.title = element_text(size = 18),\n        axis.ticks = element_blank(),\n        text = element_text(family = \"Lato\")) \n\nadelie_qq <- ggplot(data = adelie, aes(sample = bill_length_mm)) +\n  stat_qq_line(linewidth = 1) +\n  stat_qq(col = col1) +\n  labs(x = \"Theoretical\", y = \"Sample\") +\n  theme_bw() +\n  theme(panel.grid = element_blank(),\n        axis.text = element_text(size = 18),\n        axis.title = element_text(size = 18),\n        axis.ticks = element_blank(),\n        text = element_text(family = \"Lato\")) \n\nshapiro.test(adelie$bill_length_mm)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tShapiro-Wilk normality test\n\ndata:  adelie$bill_length_mm\nW = 0.99336, p-value = 0.7166\n```\n:::\n\n```{.r .cell-code}\nchinstrap <- penguins %>% \n  filter(species == \"Chinstrap\")\n\nchinstrap_hist <- ggplot(data = chinstrap, aes(x = bill_length_mm)) +\n  geom_histogram(bins = 10, fill = col2, color = col2, alpha = 0.8) +\n  labs(x = \"Bill length (mm)\", y = \"Count\") +\n  theme_bw() +\n  theme(panel.grid = element_blank(),\n        axis.text = element_text(size = 18),\n        axis.title = element_text(size = 18),\n        axis.ticks = element_blank(),\n        text = element_text(family = \"Lato\")) \n\nchinstrap_qq <- ggplot(data = chinstrap, aes(sample = bill_length_mm)) +\n  stat_qq_line(linewidth = 1) +\n  stat_qq(col = col2) +\n  labs(x = \"Theoretical\", y = \"Sample\") +\n  theme_bw() +\n  theme(panel.grid = element_blank(),\n        axis.text = element_text(size = 18),\n        axis.title = element_text(size = 18),\n        axis.ticks = element_blank(),\n        text = element_text(family = \"Lato\")) \n\nshapiro.test(chinstrap$bill_length_mm)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tShapiro-Wilk normality test\n\ndata:  chinstrap$bill_length_mm\nW = 0.97525, p-value = 0.1941\n```\n:::\n\n```{.r .cell-code}\ngentoo <- penguins %>% \n  filter(species == \"Gentoo\")\n\ngentoo_hist <- ggplot(data = gentoo, aes(x = bill_length_mm)) +\n  geom_histogram(bins = 10, fill = col3, color = col3, alpha = 0.8) +\n  labs(x = \"Bill length (mm)\", y = \"Count\") +\n  theme_bw() +\n  theme(panel.grid = element_blank(),\n        axis.text = element_text(size = 18),\n        axis.title = element_text(size = 18),\n        axis.ticks = element_blank(),\n        text = element_text(family = \"Lato\")) \n\ngentoo_qq <- ggplot(data = gentoo, aes(sample = bill_length_mm)) +\n  stat_qq_line(linewidth = 1) +\n  stat_qq(col = col3) +\n  labs(x = \"Theoretical\", y = \"Sample\") +\n  theme_bw() +\n  theme(panel.grid = element_blank(),\n        axis.text = element_text(size = 18),\n        axis.title = element_text(size = 18),\n        axis.ticks = element_blank(),\n        text = element_text(family = \"Lato\")) \n\n\n(adelie_hist + adelie_qq) / (chinstrap_hist + chinstrap_qq) / (gentoo_hist + gentoo_qq)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 1 rows containing non-finite values (`stat_bin()`).\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 1 rows containing non-finite values (`stat_qq_line()`).\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 1 rows containing non-finite values (`stat_qq()`).\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 1 rows containing non-finite values (`stat_bin()`).\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 1 rows containing non-finite values (`stat_qq_line()`).\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 1 rows containing non-finite values (`stat_qq()`).\n```\n:::\n\n::: {.cell-output-display}\n![](lecture-06_2023-05-08_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n\n```{.r .cell-code}\nshapiro.test(gentoo$bill_length_mm)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tShapiro-Wilk normality test\n\ndata:  gentoo$bill_length_mm\nW = 0.97272, p-value = 0.01349\n```\n:::\n\n```{.r .cell-code}\nleveneTest(bill_length_mm ~ species, data = penguins)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLevene's Test for Homogeneity of Variance (center = median)\n       Df F value Pr(>F)\ngroup   2  2.2425 0.1078\n      339               \n```\n:::\n\n```{.r .cell-code}\npenguins_anova <- aov(bill_length_mm ~ species, data = penguins)\npenguins_anova\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\n   aov(formula = bill_length_mm ~ species, data = penguins)\n\nTerms:\n                 species Residuals\nSum of Squares  7194.317  2969.888\nDeg. of Freedom        2       339\n\nResidual standard error: 2.959853\nEstimated effects may be unbalanced\n2 observations deleted due to missingness\n```\n:::\n\n```{.r .cell-code}\nsummary(penguins_anova)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n             Df Sum Sq Mean Sq F value Pr(>F)    \nspecies       2   7194    3597   410.6 <2e-16 ***\nResiduals   339   2970       9                   \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n2 observations deleted due to missingness\n```\n:::\n\n```{.r .cell-code}\nTukeyHSD(penguins_anova)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  Tukey multiple comparisons of means\n    95% family-wise confidence level\n\nFit: aov(formula = bill_length_mm ~ species, data = penguins)\n\n$species\n                      diff       lwr        upr     p adj\nChinstrap-Adelie 10.042433  9.024859 11.0600064 0.0000000\nGentoo-Adelie     8.713487  7.867194  9.5597807 0.0000000\nGentoo-Chinstrap -1.328945 -2.381868 -0.2760231 0.0088993\n```\n:::\n:::\n\n\n## ANOVA information\n\n### Sum of squares\n\n#### among groups\n\n$$\n\\sum_{i=1}^{k}\\sum_{j=1}^{n}(\\bar{x}_i - \\bar{x})^2\n$$\n\n#### within groups\n$$\n\\sum_{i=1}^{k}\\sum_{j=1}^{n}({x}_{ij} - \\bar{x}_i)^2\n$$\n\n#### total\n$$\n\\sum_{i=1}^{k}\\sum_{j=1}^{n}({x}_{ij} - \\bar{x})^2\n$$\n\n### Mean squares\n\n#### among groups\n\n$$\n\\frac{SS_{among\\;group}}{k-1}\n$$\n#### within group\n\n$$\n\\frac{SS_{within\\;group}}{n-k}\n$$\n#### total\n\n$$\n\\frac{SS_{total}}{kn-1}\n$$\n\n### F-ratio\n\n$$\n\\frac{MS_{among\\;group}}{MS_{within\\;group}}\n$$\n\n## penguins visualization\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = penguins, aes(x = species, y = bill_length_mm, fill = species)) +\n  geom_violin(alpha = 0.6) +\n  geom_boxplot(width = 0.2) +\n  scale_fill_manual(values = c(col1, col2, col3)) +\n  labs(x = \"Species\", y = \"Bill length (mm)\") +\n  theme_bw() +\n  theme(panel.grid = element_blank(),\n        axis.text = element_text(size = 18),\n        axis.title = element_text(size = 18),\n        text = element_text(family = \"Lato\"),\n        legend.position = \"none\") \n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 2 rows containing non-finite values (`stat_ydensity()`).\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 2 rows containing non-finite values (`stat_boxplot()`).\n```\n:::\n\n::: {.cell-output-display}\n![](lecture-06_2023-05-08_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n\n# Kruskal-Wallis\n\n## test statistic\n\n$$\nH = \\frac{12}{n(n+1)}\\sum_{i = 1}^{k}\\frac{R^2_i}{n_i}-3(n+1)\n$$\n\n## eta squared\n\n$$\n\\eta^2 = \\frac{H - k + 1}{n - k}\n$$\n\n\n\n\n\n\n\n\n\n\n\n\n",
    "supporting": [
      "lecture-06_2023-05-08_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}