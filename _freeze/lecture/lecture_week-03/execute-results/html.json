{
  "hash": "de797f65308e0dceaa91af62d2999d57",
  "result": {
    "markdown": "---\ntitle: \"Week 3 figures - Lectures 5 and 6\"\neditor: source\nfreeze: auto\nexecute:\n  message: false\n  warning: false\nformat:\n  html: \n    code-fold: true\nauthor:\n  - name: An Bui\n    url: https://an-bui.com/\n    affiliation: UC Santa Barbara, Ecology, Evolution, and Marine Biology\n    affiliation-url: https://www.eemb.ucsb.edu/\npublished-title: \"Lecture date\"\ndate: 2024-04-16\ndate-modified: last-modified\ncategories: [t-test, cohen's d, confidence intervals]\ncitation:\n  url: https://spring-2024.envs-193ds.com/lecture/lecture_week-03.html\n---\n\n\n## 0. set up\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# cleaning\nlibrary(tidyverse)\ntheme_set(theme_classic() +\n            theme(panel.grid = element_blank(),\n                  axis.text = element_text(size = 18),\n                  axis.title = element_text(size = 18),\n                  text = element_text(family = \"Lato\")))\n\n# calculate effect size\nlibrary(effsize)\n\n# visualization\nlibrary(patchwork)\n```\n:::\n\n\n\n## 1. Math\n\n### a. one sample t-test\n\n$$\nt = \\frac{\\bar{y} - \\mu}{s/\\sqrt{n}}\n$$\n\n### b. when variances are equal (Student's)\n\n$$\nt = \\frac{\\bar{x_A} - \\bar{x_B}}{s_p \\times \\sqrt{\\frac{1}{N_A + N_B}}}\n$$\n\n$$\ndf = (N_A - 1) + (N_B - 1)\n$$\n\n### c. when variances are not equal (Welch's)\n\n$$\nt = \\frac{\\bar{x_A} - \\bar{x_B}}{\\sqrt{\\frac{s_A^2}{N_A}+\\frac{s_B^2}{N_B}}}\n$$\n\n$$\ndf = \\frac{(\\frac{s_A^2}{N_A}+\\frac{S_B^2}{N_B})^2}{\\frac{(\\frac{s_A^2}{N_A})^2}{N_A-1}+\\frac{(\\frac{s_B^2}{N_B})^2}{N_B-1}}\n$$\n\n### d. Cohen's d\n\n$$\nCohen's \\; d = \\frac{\\bar{x_A} - \\bar{x_B}}{\\sqrt{(s^2_A + s^2_B)/2}}\n$$\n\n### e. confidence interval for two-sample t-test\n\n$$\nCI = (\\bar{x_A} - \\bar{x_B}) \\pm t \\times \\sqrt{\\frac{(n_A - 1)s_A^2 + (n_B - 1)s_B^2}{n_A+n_B-2}} \\times \\sqrt{\\frac{1}{n_A}+\\frac{1}{n_B}}\n$$\n\n\n## 6. one vs two tailed figure\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntwo <- ggplot(data.frame(x = -5:5), aes(x)) +\n  stat_function(geom = \"area\", fun = dt, args = list(df = 1), xlim = c(3, 5), fill = \"darkgrey\") +\n  geom_linerange(aes(x = 3, ymin = 0, ymax = 0.032), linewidth = 1, lty = 2, color = \"#000000\") +\n  stat_function(geom = \"area\", fun = dt, args = list(df = 1), xlim = c(-5, -3), fill = \"darkgrey\") +\n  geom_linerange(aes(x = -3, ymin = 0, ymax = 0.032), linewidth = 1, lty = 2, color = \"#000000\") +\n  stat_function(geom = \"line\", n = 1000, fun = dt, args = list(df = 1), linewidth = 1, color = \"#000000\") +\n  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.32)) +\n  theme_void() +\n  theme(panel.grid = element_blank())\n\none <- ggplot(data.frame(x = -5:5), aes(x)) +\n  stat_function(geom = \"area\", fun = dt, args = list(df = 1), xlim = c(2, 5), fill = \"darkgrey\") +\n  geom_linerange(aes(x = 2, ymin = 0, ymax = 0.063), linewidth = 1, lty = 2, color = \"#000000\") +\n  stat_function(geom = \"line\", n = 1000, fun = dt, args = list(df = 1), linewidth = 1, color = \"#000000\") +\n  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.32)) +\n  theme_void() +\n  theme(panel.grid = element_blank())\n\none + two\n```\n\n::: {.cell-output-display}\n![](lecture_week-03_files/figure-html/one-two-tailed-test-comparison-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n### calculating a critical value\n\n::: {.cell}\n\n```{.r .cell-code}\nqt(p = 0.05/2, df = 19)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] -2.093024\n```\n:::\n:::\n\n\n### calculating t-score\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# population mean\nmu0 <- 2\n\n# number of observations\nn <- 20\n\n# sample mean\nybar <- mean(leaves)\n\n# sample standard deviation\ns <- sd(leaves)\n\n# sample standard error\nse <- s/sqrt(n)\n\n# degrees of freedom\ndf <- n - 1\n\n# t-score\nt <- (ybar-mu0)/se\n\nt\n```\n:::\n\n\n$$\nSE = \\frac{s}{\\sqrt{n}} = \\frac{0.371}{4.47} = 0.08\n$$\n\n### visual representation of sample t-statistic vs t-critical\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data.frame(x = -5:5), aes(x)) +\n  stat_function(geom = \"area\", fun = dt, args = list(df = 1), xlim = c(1.8, 5), fill = \"darkgrey\") +\n  stat_function(geom = \"area\", fun = dt, args = list(df = 1), xlim = c(-5, -1.8), fill = \"darkgrey\") +\n  geom_linerange(aes(x = 1.8, ymin = 0, ymax = 0.075), linewidth = 1, lty = 2, color = \"#000000\") +\n  geom_linerange(aes(x = -1.8, ymin = 0, ymax = 0.075), linewidth = 1, lty = 2, color = \"#000000\") +\n  \n  geom_linerange(aes(x = 2.021, ymin = 0, ymax = 0.075), linewidth = 1, lty = 3, color = \"#FFFFFF\") +\n  geom_linerange(aes(x = -2.021, ymin = 0, ymax = 0.075), linewidth = 1, lty = 3, color = \"#FFFFFF\") +\n  stat_function(geom = \"line\", n = 1000, fun = dt, args = list(df = 1), linewidth = 1, color = \"#000000\") +\n  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.32)) +\n  theme_void() +\n  theme(panel.grid = element_blank(),\n        plot.margin = unit(c(1, 0, 0, 0), \"cm\"))\n```\n\n::: {.cell-output-display}\n![](lecture_week-03_files/figure-html/sample-t-vs-t-crit-1.png){width=672}\n:::\n:::\n\n\n### manually calculating p-value\n\n::: {.cell}\n\n```{.r .cell-code}\n# two-tailed: multiply probability by 2\n# lower = FALSE: probability of the value being more than t\n2*pt(t, df, lower = FALSE)\n```\n:::\n\n\n### doing a t-test\n\n::: {.cell}\n\n```{.r .cell-code}\nt.test(leaves, mu = 0)\n```\n:::\n\n\n## 8. two-sample t-test\n\n\n::: {.cell}\n\n```{.r .cell-code}\nex1 <- ggplot(data.frame(x = -8:8), aes(x)) +\n  stat_function(geom = \"line\", n = 100, fun = dnorm, args = list(mean = 0, sd = 2), linewidth = 2, color = \"#FF6B2B\") +\n  geom_vline(aes(xintercept = 0), color = \"#FF6B2B\", lty = 2, linewidth = 2) +\n  stat_function(geom = \"line\", n = 100, fun = dnorm, args = list(mean = 1, sd = 2), linewidth = 2, color = \"#00A38D\") +\n  geom_vline(aes(xintercept = 1), color = \"#00A38D\", lty = 2, linewidth = 2) +\n    scale_y_continuous(expand = c(0, 0), limits = c(0, 0.21)) +\n  theme_void() +\n  theme(plot.margin = unit(c(1, 1, 1, 1), \"cm\"))\n\nset.seed(2)\nx <- rnorm(30, mean = 0, sd = 2)\ny <- rnorm(30, mean = 1, sd = 2)\n\nt.test(x = x, y = y, var.equal = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tTwo Sample t-test\n\ndata:  x and y\nt = -0.78852, df = 58, p-value = 0.4336\nalternative hypothesis: true difference in means is not equal to 0\n95 percent confidence interval:\n -1.6721807  0.7270662\nsample estimates:\nmean of x mean of y \n0.4573436 0.9299009 \n```\n:::\n\n```{.r .cell-code}\n# 0.43\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nex2 <- ggplot(data.frame(x = -8:17), aes(x)) +\n  stat_function(geom = \"line\", n = 100, fun = dnorm, args = list(mean = 0, sd = 2), linewidth = 2, color = \"#FF6B2B\") +\n  geom_vline(aes(xintercept = 0), color = \"#FF6B2B\", lty = 2, linewidth = 2) +\n  stat_function(geom = \"line\", n = 100, fun = dnorm, args = list(mean = 2, sd = 2), linewidth = 2, color = \"#00A38D\") +\n  geom_vline(aes(xintercept = 2), color = \"#00A38D\", lty = 2, linewidth = 2) +\n    scale_y_continuous(expand = c(0, 0), limits = c(0, 0.21)) +\n  theme_void() +\n  theme(plot.margin = unit(c(1, 1, 1, 1), \"cm\"))\n\nset.seed(1000000000)\nx <- rnorm(30, mean = 0, sd = 2)\ny <- rnorm(30, mean = 2, sd = 2)\n\nt.test(x = x, y = y, var.equal = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tTwo Sample t-test\n\ndata:  x and y\nt = -3.7904, df = 58, p-value = 0.0003603\nalternative hypothesis: true difference in means is not equal to 0\n95 percent confidence interval:\n -2.7905631 -0.8617609\nsample estimates:\nmean of x mean of y \n0.1435745 1.9697364 \n```\n:::\n\n```{.r .cell-code}\n# 0.6932\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nex3 <- ggplot(data.frame(x = -8:17), aes(x)) +\n  stat_function(geom = \"line\", n = 100, fun = dnorm, args = list(mean = 0, sd = 2), linewidth = 2, color = \"#FF6B2B\") +\n  geom_vline(aes(xintercept = 0), color = \"#FF6B2B\", lty = 2, linewidth = 2) +\n  stat_function(geom = \"line\", n = 100, fun = dnorm, args = list(mean = 10, sd = 2), linewidth = 2, color = \"#00A38D\") +\n  geom_vline(aes(xintercept = 10), color = \"#00A38D\", lty = 2, linewidth = 2) +\n    scale_y_continuous(expand = c(0, 0), limits = c(0, 0.21)) +\n  theme_void() +\n  theme(plot.margin = unit(c(1, 1, 1, 1), \"cm\"))\n\nset.seed(100)\nx <- rnorm(40, mean = 0, sd = 2)\ny <- rnorm(40, mean = 10, sd = 2)\n\nt.test(x = x, y = y, var.equal = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tTwo Sample t-test\n\ndata:  x and y\nt = -21.69, df = 78, p-value < 2.2e-16\nalternative hypothesis: true difference in means is not equal to 0\n95 percent confidence interval:\n -10.564878  -8.788488\nsample estimates:\nmean of x mean of y \n0.2003543 9.8770375 \n```\n:::\n\n```{.r .cell-code}\n# p < 0.001\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nex1 + ex2 + ex3\n```\n\n::: {.cell-output-display}\n![](lecture_week-03_files/figure-html/two-sample-examples-together-1.png){fig-align='center' width=1152}\n:::\n:::\n\n\n### same differences in means, different SD\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsmall <- ggplot(data.frame(x = -6:9), aes(x)) +\n  stat_function(geom = \"line\", n = 100, fun = dnorm, args = list(mean = 0, sd = 2), linewidth = 2, color = \"#FF6B2B\") +\n  geom_vline(aes(xintercept = 0), color = \"#FF6B2B\", lty = 2, linewidth = 2) +\n  stat_function(geom = \"line\", n = 100, fun = dnorm, args = list(mean = 3, sd = 2), linewidth = 2, color = \"#0070C0\") +\n  geom_vline(aes(xintercept = 3), color = \"#0070C0\", lty = 2, linewidth = 2) +\n  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.21)) +\n  theme_void() +\n  theme(plot.margin = unit(c(1, 1, 1, 1), \"cm\"))\n\nbig <- ggplot(data.frame(x = -6:9), aes(x)) +\n  stat_function(geom = \"line\", n = 100, fun = dnorm, args = list(mean = 0, sd = 0.5), linewidth = 2, color = \"#FF6B2B\") +\n  geom_vline(aes(xintercept = 0), color = \"#FF6B2B\", lty = 2, linewidth = 2) +\n  stat_function(geom = \"line\", n = 100, fun = dnorm, args = list(mean = 3, sd = 0.5), linewidth = 2, color = \"#0070C0\") +\n  geom_vline(aes(xintercept = 3), color = \"#0070C0\", lty = 2, linewidth = 2) +\n  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.8)) +\n  theme_void() +\n  theme(plot.margin = unit(c(1, 1, 1, 1), \"cm\"))\n\ndiff <- ggplot(data.frame(x = -6:9), aes(x)) +\n  stat_function(geom = \"line\", n = 100, fun = dnorm, args = list(mean = 0, sd = 0.5), linewidth = 2, color = \"#FF6B2B\") +\n  geom_vline(aes(xintercept = 0), color = \"#FF6B2B\", lty = 2, linewidth = 2) +\n  stat_function(geom = \"line\", n = 100, fun = dnorm, args = list(mean = 3, sd = 1.25), linewidth = 2, color = \"#0070C0\") +\n  geom_vline(aes(xintercept = 3), color = \"#0070C0\", lty = 2, linewidth = 2) +\n  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.85)) +\n  theme_void() +\n  theme(plot.margin = unit(c(1, 1, 1, 1), \"cm\"))\n\nsmall / big / diff\n```\n\n::: {.cell-output-display}\n![](lecture_week-03_files/figure-html/two-sample-means-different-variances-1.png){width=768}\n:::\n:::\n\n\n\n### F-distribution\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data.frame(x = seq(from = 0, to = 4, by = 0.1)), aes(x)) +\n  stat_function(geom = \"line\", fun = df, args = list(df1 = 20, df2 = 20), color = \"#FF6B2B\", linewidth = 1, xlim = c(0, 4)) +\n  stat_function(geom = \"line\", fun = df, args = list(df1 = 5, df2 = 5), color = \"#0070C0\", linewidth = 1, xlim = c(0, 4)) +\n  stat_function(geom = \"line\", fun = df, args = list(df1 = 1, df2 = 5), linewidth = 1, xlim = c(0, 4)) +\n  annotate(\"text\", x = 1.5, y = 1, label = \"20, 20\", color = \"#FF6B2B\", size = 8) +\n  annotate(\"text\", x = -0.2, y = 0.5, label = \"5, 5\", color = \"#0070C0\", size = 8) +\n  annotate(\"text\", x = 0.5, y = 1.5, label = \"1, 5\", size = 8) + \n  scale_y_continuous(expand = c(0, 0)) +\n  theme(axis.text = element_blank(),\n        axis.line = element_blank(),\n        axis.ticks = element_blank(),\n        axis.title = element_blank())\n```\n\n::: {.cell-output-display}\n![](lecture_week-03_files/figure-html/f-distribution-1.png){width=672}\n:::\n:::\n\n\n### F-distribution example\n\n::: {.cell}\n\n```{.r .cell-code}\nrats <- rnorm(n = 20, mean = 178, sd = 43)\nmice <- rnorm(n = 20, mean = 120, sd = 20)\n\nmean(rats)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 175.2984\n```\n:::\n\n```{.r .cell-code}\nmean(mice)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 119.7886\n```\n:::\n\n```{.r .cell-code}\nvar(rats)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 2421.866\n```\n:::\n\n```{.r .cell-code}\nvar(mice)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 292.9476\n```\n:::\n\n```{.r .cell-code}\nvar(rats)/var(mice)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 8.267233\n```\n:::\n\n```{.r .cell-code}\nvar.test(rats, mice)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tF test to compare two variances\n\ndata:  rats and mice\nF = 8.2672, num df = 19, denom df = 19, p-value = 2.586e-05\nalternative hypothesis: true ratio of variances is not equal to 1\n95 percent confidence interval:\n  3.272271 20.886758\nsample estimates:\nratio of variances \n          8.267233 \n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nt.test(rats, mice, var.equal = FALSE)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tWelch Two Sample t-test\n\ndata:  rats and mice\nt = 4.7645, df = 23.53, p-value = 7.925e-05\nalternative hypothesis: true difference in means is not equal to 0\n95 percent confidence interval:\n 31.43827 79.58119\nsample estimates:\nmean of x mean of y \n 175.2984  119.7886 \n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n(mean(rats) - mean(mice))/sqrt((var(rats) + var(mice))/2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 1.506656\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncohen.d(rats, mice)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCohen's d\n\nd estimate: 1.506656 (large)\n95 percent confidence interval:\n   lower    upper \n0.781326 2.231986 \n```\n:::\n:::\n\n\n\ntesting test statistic formula to compare against t-test from above:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nxa <- mean(x)\nxb <- mean(y)\n\nvara <- var(x)\nvarb <- var(y)\n\nnA <- length(x)\nnB <- length(y)\n\n(xa - xb)/sqrt((vara/nA)+(varb/nB))\n(nA - 1) + (nB - 1)\n\n(((vara/nA)+(varb/nB))^2)/((vara/nA)^2/(nA-1)+(varb/nB)^2/(nB-1))\n```\n:::\n",
    "supporting": [
      "lecture_week-03_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}