{
  "hash": "6b265ea4e0cf8dd0f794ee618f7c45ec",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Week 4 figures - Lectures 7 and 8\"\neditor: source\nfreeze: auto\nexecute:\n  message: false\n  warning: false\nformat:\n  html: \n    code-fold: true\nauthor:\n  - name: An Bui\n    url: https://an-bui.com/\n    affiliation: UC Santa Barbara, Ecology, Evolution, and Marine Biology\n    affiliation-url: https://www.eemb.ucsb.edu/\npublished-title: \"Lecture date\"\ndate: 2024-04-21\ndate-modified: last-modified\ncategories: []\ncitation:\n  url: https://spring-2024.envs-193ds.com/lecture/lecture_week-04.html\n---\n\n\n\n## 0. set up\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# cleaning\nlibrary(tidyverse)\n\n# visualization\ntheme_set(theme_classic() +\n            theme(panel.grid = element_blank(),\n                  axis.text = element_text(size = 18),\n                  axis.title = element_text(size = 18),\n                  text = element_text(family = \"Lato\")))\nlibrary(patchwork)\n\n# cohen's d\nlibrary(effectsize)\n\n# power\nlibrary(pwr)\n```\n:::\n\n\n## 1. Math\n\n\n### a. Cohen's d\n\n$$\nCohen's \\; d = \\frac{\\bar{y_A} - \\bar{y_B}}{\\sqrt{(s^2_A + s^2_B)/2}}\n$$\n\n### b. Cohen's d with separated SD\n\n$$\nCohen's \\; d = \\frac{\\bar{y_A} - \\bar{y_B}}{\\sqrt{\\frac{(n_A - 1)\\times s^2_A + (n_B - 1)\\times s^2_B}{n_A + n_B + 2}}}\n$$\n\n\n\n### b. confidence interval for two-sample t-test\n\n$$\nCI = (\\bar{y_A} - \\bar{y_B}) \\pm t \\times \\sqrt{\\frac{(n_A - 1)s_A^2 + (n_B - 1)s_B^2}{n_A+n_B-2}} \\times \\sqrt{\\frac{1}{n_A}+\\frac{1}{n_B}}\n$$\n\n### c. test statistic for paired t-test\n\n$$\nt_s = \\frac{\\bar{y}_d - \\mu_0}{s_d - \\sqrt{n}}\n$$\n\n### d. standard error for two-sample t-test\n\nIf variances are not equal:\n\n$$\nSE_{\\bar{y_A} - \\bar{y_B}} = \\sqrt{\\frac{s_A^2}{n_A}+\\frac{s_B^2}{n_B}}\n$$\n\n## 2. Interpret this output\n\nYou have two raised beds in which you're growing tomatoes. One bed is in the sun, but the other is in shade. You want to know if the weight of the tomatoes is different between beds. You measure 33 tomatoes from each bed.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntomatoes <- cbind(sunny = rnorm(n = 33, mean = 150, sd = 20),\n                  shaded = rnorm(n = 33, mean = 130, sd = 10)) %>% \n  as_tibble() %>% \n  pivot_longer(cols = 1:2, names_to = \"sun_level\", values_to = \"weight_g\")\n\nggplot(data = tomatoes,\n       aes(x = sun_level,\n           y = weight_g)) +\n  geom_jitter(width = 0.1)\n```\n\n::: {.cell-output-display}\n![](lecture_week-04_files/figure-html/tomatoes-1.png){width=672}\n:::\n\n```{.r .cell-code}\nvar.test(weight_g ~ sun_level,\n         data = tomatoes)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tF test to compare two variances\n\ndata:  weight_g by sun_level\nF = 0.18086, num df = 32, denom df = 32, p-value = 5.395e-06\nalternative hypothesis: true ratio of variances is not equal to 1\n95 percent confidence interval:\n 0.08932403 0.36619345\nsample estimates:\nratio of variances \n         0.1808587 \n```\n\n\n:::\n\n```{.r .cell-code}\nt.test(weight_g ~ sun_level,\n       data = tomatoes,\n       var.equal = FALSE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tWelch Two Sample t-test\n\ndata:  weight_g by sun_level\nt = -4.7037, df = 43.208, p-value = 2.632e-05\nalternative hypothesis: true difference in means between group shaded and group sunny is not equal to 0\n95 percent confidence interval:\n -26.85729 -10.73987\nsample estimates:\nmean in group shaded  mean in group sunny \n            130.9212             149.7197 \n```\n\n\n:::\n:::\n\n\n\n## 3. Power analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# higher power\npwr.t.test(n = NULL, d = 0.7, sig.level = 0.05, power = 0.95)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n     Two-sample t test power calculation \n\n              n = 54.01938\n              d = 0.7\n      sig.level = 0.05\n          power = 0.95\n    alternative = two.sided\n\nNOTE: n is number in *each* group\n```\n\n\n:::\n\n```{.r .cell-code}\n# lower power\npwr.t.test(n = NULL, d = 0.7, sig.level = 0.05, power = 0.80)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n     Two-sample t test power calculation \n\n              n = 33.02457\n              d = 0.7\n      sig.level = 0.05\n          power = 0.8\n    alternative = two.sided\n\nNOTE: n is number in *each* group\n```\n\n\n:::\n:::\n\n\n## 4. Write about this result\n\nYou have two worm compost bins: one in which you throw citrus peels, and the other in which you don’t. You’re curious to see if the citrus worms are bigger than the non-citrus worms. You measure 34 worms from each bin and find this result:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nworms <- cbind(citrus = rnorm(n = 34, mean = 140, sd = 20),\n               non_citrus = rnorm(n = 34, mean = 160, sd = 15)) %>% \n  as_tibble() %>% \n  pivot_longer(cols = 1:2, names_to = \"compost_bin\", values_to = \"weight_g\")\n\nggplot(data = worms,\n       aes(x = compost_bin,\n           y = weight_g)) +\n  geom_boxplot()\n```\n\n::: {.cell-output-display}\n![](lecture_week-04_files/figure-html/worm-compost-1.png){width=672}\n:::\n\n```{.r .cell-code}\nvar.test(weight_g ~ compost_bin,\n         data = worms)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tF test to compare two variances\n\ndata:  weight_g by compost_bin\nF = 1.6649, num df = 33, denom df = 33, p-value = 0.1483\nalternative hypothesis: true ratio of variances is not equal to 1\n95 percent confidence interval:\n 0.8314885 3.3336165\nsample estimates:\nratio of variances \n          1.664892 \n```\n\n\n:::\n\n```{.r .cell-code}\nt.test(weight_g ~ compost_bin,\n       data = worms,\n       var.equal = FALSE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tWelch Two Sample t-test\n\ndata:  weight_g by compost_bin\nt = -5.3344, df = 62.132, p-value = 1.426e-06\nalternative hypothesis: true difference in means between group citrus and group non_citrus is not equal to 0\n95 percent confidence interval:\n -27.87176 -12.67741\nsample estimates:\n    mean in group citrus mean in group non_citrus \n                141.7282                 162.0028 \n```\n\n\n:::\n:::\n\n\n\n## 5. Effect size examples\n\n### a. large sample size, small difference\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(1)\nsmall <- cbind(a = rnorm(n = 10, mean = 10, sd = 2), \n               b = rnorm(n = 10, mean = 11, sd = 2)) %>% \n  as_tibble() %>% \n  pivot_longer(cols = 1:2, names_to = \"group\", values_to = \"value\")\nt.test(value ~ group,\n       data = small,\n       var.equal = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tTwo Sample t-test\n\ndata:  value by group\nt = -1.4727, df = 18, p-value = 0.1581\nalternative hypothesis: true difference in means between group a and group b is not equal to 0\n95 percent confidence interval:\n -2.9926364  0.5260676\nsample estimates:\nmean in group a mean in group b \n       10.26441        11.49769 \n```\n\n\n:::\n\n```{.r .cell-code}\nset.seed(1)\nlarge <- cbind(a = rnorm(n = 100, mean = 10, sd = 2), \n               b = rnorm(n = 100, mean = 11, sd = 2)) %>% \n  as_tibble() %>% \n  pivot_longer(cols = 1:2, names_to = \"group\", values_to = \"value\")\nt.test(value ~ group,\n       data = large,\n       var.equal = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tTwo Sample t-test\n\ndata:  value by group\nt = -2.6906, df = 198, p-value = 0.007743\nalternative hypothesis: true difference in means between group a and group b is not equal to 0\n95 percent confidence interval:\n -1.2245098 -0.1887085\nsample estimates:\nmean in group a mean in group b \n       10.21777        10.92438 \n```\n\n\n:::\n:::\n\n\n\n### b. needlegrass example\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(1)\nneedlegrass <- cbind(ungrazed = rnorm(n = 35, mean = 80, sd = 10), \n                     grazed = rnorm(n = 35, mean = 74, sd = 5)) %>% \n  as_tibble() %>% \n  pivot_longer(cols = 1:2, names_to = \"plot_type\", values_to = \"height_cm\")\n\n# plot without all the adjustments\nggplot(data = needlegrass,\n       aes(x = plot_type,\n           y = height_cm,\n           color = plot_type)) +\n  geom_point(position = position_jitter(width = 0.1, height = 0, seed = 10),\n             alpha = 0.2) +\n  stat_summary(geom = \"pointrange\",\n               fun.data = mean_cl_normal) \n```\n\n::: {.cell-output-display}\n![](lecture_week-04_files/figure-html/needlegrass-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# \"finalized\" plot\nggplot(data = needlegrass,\n       aes(x = plot_type,\n           y = height_cm,\n           color = plot_type)) +\n  geom_point(position = position_jitter(width = 0.1, height = 0, seed = 10),\n             alpha = 0.2) +\n  scale_color_manual(values = c(\"darkgreen\", \"cornflowerblue\")) +\n  stat_summary(geom = \"pointrange\",\n               fun.data = mean_cl_normal,\n               size = 1,\n               linewidth = 1) +\n  labs(x = \"Plot type\",\n       y = \"Height (cm)\") +\n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![](lecture_week-04_files/figure-html/needlegrass-2.png){width=672}\n:::\n:::\n\n\nDoing a t-test:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvar.test(height_cm ~ plot_type,\n       data = needlegrass)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tF test to compare two variances\n\ndata:  height_cm by plot_type\nF = 0.26151, num df = 34, denom df = 34, p-value = 0.0001765\nalternative hypothesis: true ratio of variances is not equal to 1\n95 percent confidence interval:\n 0.1320008 0.5180813\nsample estimates:\nratio of variances \n         0.2615094 \n```\n\n\n:::\n\n```{.r .cell-code}\nt.test(height_cm ~ plot_type,\n       data = needlegrass,\n       var.equal = FALSE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tWelch Two Sample t-test\n\ndata:  height_cm by plot_type\nt = -3.2032, df = 50.644, p-value = 0.002351\nalternative hypothesis: true difference in means between group grazed and group ungrazed is not equal to 0\n95 percent confidence interval:\n -9.084836 -2.083807\nsample estimates:\n  mean in group grazed mean in group ungrazed \n              75.18323               80.76756 \n```\n\n\n:::\n:::\n\n\nCohen's d:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# pooled SD\ncohens_d(height_cm ~ plot_type,\n       data = needlegrass)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCohen's d |         95% CI\n--------------------------\n-0.77     | [-1.25, -0.28]\n\n- Estimated using pooled SD.\n```\n\n\n:::\n\n```{.r .cell-code}\n# unpooled SD\ncohens_d(height_cm ~ plot_type,\n       data = needlegrass, \n       pooled_sd = FALSE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCohen's d |         95% CI\n--------------------------\n-0.77     | [-1.25, -0.27]\n\n- Estimated using un-pooled SD.\n```\n\n\n:::\n\n```{.r .cell-code}\n# by hand\nneedlegrass_sum <- needlegrass %>% \n  group_by(plot_type) %>% \n  reframe(\n    mean = mean(height_cm),\n    var = var(height_cm),\n    n = length(height_cm)\n  )\n\nya <- pluck(needlegrass_sum, 2, 1)\nyb <- pluck(needlegrass_sum, 2, 2)\nvara <- pluck(needlegrass_sum, 3, 1)\nvarb <- pluck(needlegrass_sum, 3, 2)\nna <- pluck(needlegrass_sum, 4, 1)\nnb <- pluck(needlegrass_sum, 4, 2)\n\n# by hand\n\n(ya - yb)/sqrt((vara + varb)/2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] -0.7657151\n```\n\n\n:::\n\n```{.r .cell-code}\n(ya - yb)/sqrt(\n  ((na - 1)*vara + (nb - 1)*varb)/(na + nb - 2)\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] -0.7657151\n```\n\n\n:::\n:::\n",
    "supporting": [
      "lecture_week-04_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}