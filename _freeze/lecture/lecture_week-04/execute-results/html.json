{
  "hash": "738bf8dbd7e4747ddf7b40f26fc917eb",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Week 4 figures - Lectures 7 and 8\"\neditor: source\nfreeze: auto\nexecute:\n  message: false\n  warning: false\nformat:\n  html: \n    code-fold: true\nauthor:\n  - name: An Bui\n    url: https://an-bui.com/\n    affiliation: UC Santa Barbara, Ecology, Evolution, and Marine Biology\n    affiliation-url: https://www.eemb.ucsb.edu/\npublished-title: \"Lecture date\"\ndate: 2024-04-24\ndate-modified: last-modified\ncategories: []\ncitation:\n  url: https://spring-2024.envs-193ds.com/lecture/lecture_week-04.html\n---\n\n\n\n# 0. set up\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# cleaning\nlibrary(tidyverse)\n\n# visualization\ntheme_set(theme_classic() +\n            theme(panel.grid = element_blank(),\n                  axis.text = element_text(size = 18),\n                  axis.title = element_text(size = 18),\n                  text = element_text(family = \"Lato\")))\nlibrary(patchwork)\n\n# cohen's d\nlibrary(effsize)\n```\n:::\n\n\n# 1. Math\n\n\n### d. Cohen's d\n\n$$\nCohen's \\; d = \\frac{\\bar{y_A} - \\bar{y_B}}{\\sqrt{(s^2_A + s^2_B)/2}}\n$$\n\n### e. confidence interval for two-sample t-test\n\n$$\nCI = (\\bar{y_A} - \\bar{y_B}) \\pm t \\times \\sqrt{\\frac{(n_A - 1)s_A^2 + (n_B - 1)s_B^2}{n_A+n_B-2}} \\times \\sqrt{\\frac{1}{n_A}+\\frac{1}{n_B}}\n$$\n\n\n# 2. one vs two tailed figure\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntwo <- ggplot(data.frame(x = -5:5), aes(x)) +\n  stat_function(geom = \"area\", fun = dt, args = list(df = 1), xlim = c(3, 5), fill = \"darkgrey\") +\n  geom_linerange(aes(x = 3, ymin = 0, ymax = 0.032), linewidth = 1, lty = 2, color = \"#000000\") +\n  stat_function(geom = \"area\", fun = dt, args = list(df = 1), xlim = c(-5, -3), fill = \"darkgrey\") +\n  geom_linerange(aes(x = -3, ymin = 0, ymax = 0.032), linewidth = 1, lty = 2, color = \"#000000\") +\n  stat_function(geom = \"line\", n = 1000, fun = dt, args = list(df = 1), linewidth = 1, color = \"#000000\") +\n  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.32)) +\n  theme_void() +\n  theme(panel.grid = element_blank())\n\none <- ggplot(data.frame(x = -5:5), aes(x)) +\n  stat_function(geom = \"area\", fun = dt, args = list(df = 1), xlim = c(2, 5), fill = \"darkgrey\") +\n  geom_linerange(aes(x = 2, ymin = 0, ymax = 0.063), linewidth = 1, lty = 2, color = \"#000000\") +\n  stat_function(geom = \"line\", n = 1000, fun = dt, args = list(df = 1), linewidth = 1, color = \"#000000\") +\n  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.32)) +\n  theme_void() +\n  theme(panel.grid = element_blank())\n\none + two\n```\n\n::: {.cell-output-display}\n![](lecture_week-04_files/figure-html/unnamed-chunk-2-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n\n# 1. Acorn example\n\n$$\n\\begin{align}\nn &= 41 \\\\\n\\bar{x} &= 2.29 \\\\\ns &= 1.04\n\\end{align}\n$$\n\n## random numbers from t-distribution\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(7)\n# acorns <- rt(n = 41, df = 40, ncp = 2.5) \nacorns <- rnorm(n = 41, mean = 2, sd = 1)\n```\n:::\n\n\n## histogram\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nhist <- enframe(acorns) %>% \n  ggplot(aes(x = value)) +\n  geom_histogram(bins = 7, fill = \"cornflowerblue\", color = \"#000000\") +\n  scale_y_continuous(expand = c(0, 0), limits = c(0, 11.5), breaks = c(0, 3, 6, 9, 12)) +\n  theme_classic() +\n  labs(x = \"Acorn mass (g)\", y = \"Count\")\n```\n:::\n\n\n## qq plot\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nqq <- enframe(acorns) %>% \n  ggplot(aes(sample = value)) +\n  stat_qq_line(aes(sample = value)) +\n  stat_qq(aes(sample = value), color = \"cornflowerblue\", size = 3) +\n  theme_classic() +\n  labs(x = \"Theoretical quantiles\", y = \"Sample quantiles\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhist + qq\n```\n\n::: {.cell-output-display}\n![](lecture_week-04_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n\n## calculating a critical value\n\n::: {.cell}\n\n```{.r .cell-code}\nqt(p = .05/2, df = 40)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] -2.021075\n```\n\n\n:::\n:::\n\n\n## calculating t-score\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# population mean\nmu0 <- 2\n\n# number of observations\nn <- 41\n\n# sample mean\nxbar <- mean(acorns)\n\n# sample standard deviation\ns <- sd(acorns)\n\n# sample standard error\nse <- s/sqrt(n)\n\n# degrees of freedom\ndf <- n - 1\n\n# t-score\nt <- (xbar-mu0)/se\n\nt\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1.803471\n```\n\n\n:::\n:::\n\n\n$$\nt_s = \\frac{\\bar{x} - \\mu}{s/\\sqrt{n}} = \\frac{2.29 - 2}{1.04/\\sqrt{41}} = 1.8\n$$\n## visual representation of sample t-statistic vs t-critical\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data.frame(x = -5:5), aes(x)) +\n  stat_function(geom = \"area\", fun = dt, args = list(df = 1), xlim = c(1.8, 5), fill = \"darkgrey\") +\n  stat_function(geom = \"area\", fun = dt, args = list(df = 1), xlim = c(-5, -1.8), fill = \"darkgrey\") +\n  geom_linerange(aes(x = 1.8, ymin = 0, ymax = 0.075), linewidth = 1, lty = 2, color = \"#000000\") +\n  geom_linerange(aes(x = -1.8, ymin = 0, ymax = 0.075), linewidth = 1, lty = 2, color = \"#000000\") +\n  \n  geom_linerange(aes(x = 2.021, ymin = 0, ymax = 0.075), linewidth = 1, lty = 3, color = \"#FFFFFF\") +\n  geom_linerange(aes(x = -2.021, ymin = 0, ymax = 0.075), linewidth = 1, lty = 3, color = \"#FFFFFF\") +\n  stat_function(geom = \"line\", n = 1000, fun = dt, args = list(df = 1), linewidth = 1, color = \"#000000\") +\n  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.32)) +\n  theme_void() +\n  theme(panel.grid = element_blank(),\n        plot.margin = unit(c(1, 0, 0, 0), \"cm\"))\n```\n\n::: {.cell-output-display}\n![](lecture_week-04_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n## manually calculating p-value\n\n::: {.cell}\n\n```{.r .cell-code}\n# two-tailed: multiply probability by 2\n# lower = FALSE: probability of the value being more than t\n2*pt(t, df, lower = FALSE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.07885024\n```\n\n\n:::\n:::\n\n\n## doing a t-test\n\n::: {.cell}\n\n```{.r .cell-code}\nt.test(acorns, mu = 2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tOne Sample t-test\n\ndata:  acorns\nt = 1.8035, df = 40, p-value = 0.07885\nalternative hypothesis: true mean is not equal to 2\n95 percent confidence interval:\n 1.964535 2.623323\nsample estimates:\nmean of x \n 2.293929 \n```\n\n\n:::\n:::\n\n\n# 2. two-sample t-test\n\n\n::: {.cell}\n\n```{.r .cell-code}\nex1 <- ggplot(data.frame(x = -8:8), aes(x)) +\n  stat_function(geom = \"line\", n = 100, fun = dnorm, args = list(mean = 0, sd = 2), linewidth = 2, color = \"#FF6B2B\") +\n  geom_vline(aes(xintercept = 0), color = \"#FF6B2B\", lty = 2, linewidth = 2) +\n  stat_function(geom = \"line\", n = 100, fun = dnorm, args = list(mean = 1, sd = 2), linewidth = 2, color = \"#00A38D\") +\n  geom_vline(aes(xintercept = 1), color = \"#00A38D\", lty = 2, linewidth = 2) +\n    scale_y_continuous(expand = c(0, 0), limits = c(0, 0.21)) +\n  theme_void() +\n  theme(plot.margin = unit(c(1, 1, 1, 1), \"cm\"))\n\nset.seed(2)\nx <- rnorm(30, mean = 0, sd = 2)\ny <- rnorm(30, mean = 1, sd = 2)\n\nt.test(x = x, y = y, var.equal = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tTwo Sample t-test\n\ndata:  x and y\nt = -0.78852, df = 58, p-value = 0.4336\nalternative hypothesis: true difference in means is not equal to 0\n95 percent confidence interval:\n -1.6721807  0.7270662\nsample estimates:\nmean of x mean of y \n0.4573436 0.9299009 \n```\n\n\n:::\n\n```{.r .cell-code}\n# 0.43\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nex2 <- ggplot(data.frame(x = -8:17), aes(x)) +\n  stat_function(geom = \"line\", n = 100, fun = dnorm, args = list(mean = 0, sd = 2), linewidth = 2, color = \"#FF6B2B\") +\n  geom_vline(aes(xintercept = 0), color = \"#FF6B2B\", lty = 2, linewidth = 2) +\n  stat_function(geom = \"line\", n = 100, fun = dnorm, args = list(mean = 2, sd = 2), linewidth = 2, color = \"#00A38D\") +\n  geom_vline(aes(xintercept = 1), color = \"#00A38D\", lty = 2, linewidth = 2) +\n    scale_y_continuous(expand = c(0, 0), limits = c(0, 0.21)) +\n  theme_void() +\n  theme(plot.margin = unit(c(1, 1, 1, 1), \"cm\"))\n\nset.seed(1000000000)\nx <- rnorm(30, mean = 0, sd = 2)\ny <- rnorm(30, mean = 2, sd = 2)\n\nt.test(x = x, y = y, var.equal = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tTwo Sample t-test\n\ndata:  x and y\nt = -3.7904, df = 58, p-value = 0.0003603\nalternative hypothesis: true difference in means is not equal to 0\n95 percent confidence interval:\n -2.7905631 -0.8617609\nsample estimates:\nmean of x mean of y \n0.1435745 1.9697364 \n```\n\n\n:::\n\n```{.r .cell-code}\n# 0.6932\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nex3 <- ggplot(data.frame(x = -8:17), aes(x)) +\n  stat_function(geom = \"line\", n = 100, fun = dnorm, args = list(mean = 0, sd = 2), linewidth = 2, color = \"#FF6B2B\") +\n  geom_vline(aes(xintercept = 0), color = \"#FF6B2B\", lty = 2, linewidth = 2) +\n  stat_function(geom = \"line\", n = 100, fun = dnorm, args = list(mean = 10, sd = 2), linewidth = 2, color = \"#00A38D\") +\n  geom_vline(aes(xintercept = 10), color = \"#00A38D\", lty = 2, linewidth = 2) +\n    scale_y_continuous(expand = c(0, 0), limits = c(0, 0.21)) +\n  theme_void() +\n  theme(plot.margin = unit(c(1, 1, 1, 1), \"cm\"))\n\nset.seed(100)\nx <- rnorm(40, mean = 0, sd = 2)\ny <- rnorm(40, mean = 10, sd = 2)\n\nt.test(x = x, y = y, var.equal = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tTwo Sample t-test\n\ndata:  x and y\nt = -21.69, df = 78, p-value < 2.2e-16\nalternative hypothesis: true difference in means is not equal to 0\n95 percent confidence interval:\n -10.564878  -8.788488\nsample estimates:\nmean of x mean of y \n0.2003543 9.8770375 \n```\n\n\n:::\n\n```{.r .cell-code}\n# p < 0.001\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nex1 + ex2 + ex3\n```\n\n::: {.cell-output-display}\n![](lecture_week-04_files/figure-html/unnamed-chunk-15-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n## same differences in means, different SD\n\n::: {.cell}\n\n```{.r .cell-code}\nsmall <- ggplot(data.frame(x = -6:9), aes(x)) +\n  stat_function(geom = \"line\", n = 100, fun = dnorm, args = list(mean = 0, sd = 2), linewidth = 2, color = \"#FF6B2B\") +\n  geom_vline(aes(xintercept = 0), color = \"#FF6B2B\", lty = 2, linewidth = 2) +\n  stat_function(geom = \"line\", n = 100, fun = dnorm, args = list(mean = 3, sd = 2), linewidth = 2, color = \"#00A38D\") +\n  geom_vline(aes(xintercept = 3), color = \"#00A38D\", lty = 2, linewidth = 2) +\n    scale_y_continuous(expand = c(0, 0), limits = c(0, 0.21)) +\n  theme_void() +\n  theme(plot.margin = unit(c(1, 1, 1, 1), \"cm\"))\n\nbig <- ggplot(data.frame(x = -6:9), aes(x)) +\n  stat_function(geom = \"line\", n = 100, fun = dnorm, args = list(mean = 0, sd = 0.5), linewidth = 2, color = \"#FF6B2B\") +\n  geom_vline(aes(xintercept = 0), color = \"#FF6B2B\", lty = 2, linewidth = 2) +\n  stat_function(geom = \"line\", n = 100, fun = dnorm, args = list(mean = 3, sd = 0.5), linewidth = 2, color = \"#00A38D\") +\n  geom_vline(aes(xintercept = 3), color = \"#00A38D\", lty = 2, linewidth = 2) +\n    scale_y_continuous(expand = c(0, 0), limits = c(0, 0.8)) +\n  theme_void() +\n  theme(plot.margin = unit(c(1, 1, 1, 1), \"cm\"))\n\nsmall / big\n```\n\n::: {.cell-output-display}\n![](lecture_week-04_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n\n# 3. Cohen's D\n\n\n$$\nCohen's d = \\frac{\\bar{x_A} - \\bar{x_B}}{\\sqrt{(s^2_A + s^2_B)/2}}\n$$\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncohen.d(acorns ~ ., mu = 2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCohen's d (single sample)\n\nd estimate: 0.2816548 (small)\nReference mu: 2\n95 percent confidence interval:\n     lower      upper \n-0.3527453  0.9160549 \n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\ntest statistic for unequal variances (welch's)\n\n$$\nt_s = \\frac{\\bar{x}_A - \\bar{x}_B}{\\sqrt{\\frac{s^2_A}{n_A} + \\frac{s^2_B}{n_B}}}\n$$\n\ndegrees of freedom for unequal variances (welch's)\n\n$$\ndf = \\frac{(\\frac{s^2_A}{n_A} + \\frac{s^2_B}{n_B})^2}{\\frac{(s^2_A/n_A)^2}{n_A - 1} + \\frac{(s^2_B/n_B)^2}{n_B - 1}}\n$$\n\ntest statistic for equal variances (student's t)\n\n$$\nt_s = \\frac{\\bar{x}_A - \\bar{x}_B}{s_p\\sqrt{\\frac{1}{n_A} + \\frac{1}{n_B}}}\n$$\n\n\ntest statistic for paired t-test\n\n$$\nt_s = \\frac{\\bar{x}_d - \\mu_0}{s_d - \\sqrt{n}}\n$$\n\ntest statistic for F test\n$$\nF =  \\frac{s^2_A}{s^2_B}\n$$\n\ndifferences in variances\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(patchwork)\n\nsmall <- ggplot(data.frame(x = -6:9), aes(x)) +\n  stat_function(geom = \"line\", n = 100, fun = dnorm, args = list(mean = 0, sd = 2), linewidth = 2, color = \"#FF6B2B\") +\n  geom_vline(aes(xintercept = 0), color = \"#FF6B2B\", lty = 2, linewidth = 2) +\n  stat_function(geom = \"line\", n = 100, fun = dnorm, args = list(mean = 3, sd = 2), linewidth = 2, color = \"#00A38D\") +\n  geom_vline(aes(xintercept = 3), color = \"#00A38D\", lty = 2, linewidth = 2) +\n  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.21)) +\n  theme_void() +\n  theme(plot.margin = unit(c(1, 1, 1, 1), \"cm\"))\n\nbig <- ggplot(data.frame(x = -6:9), aes(x)) +\n  stat_function(geom = \"line\", n = 100, fun = dnorm, args = list(mean = 0, sd = 0.5), linewidth = 2, color = \"#FF6B2B\") +\n  geom_vline(aes(xintercept = 0), color = \"#FF6B2B\", lty = 2, linewidth = 2) +\n  stat_function(geom = \"line\", n = 100, fun = dnorm, args = list(mean = 3, sd = 0.5), linewidth = 2, color = \"#00A38D\") +\n  geom_vline(aes(xintercept = 3), color = \"#00A38D\", lty = 2, linewidth = 2) +\n  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.8)) +\n  theme_void() +\n  theme(plot.margin = unit(c(1, 1, 1, 1), \"cm\"))\n\nunequal <- ggplot(data.frame(x = -6:9), aes(x)) +\n  stat_function(geom = \"line\", n = 100, fun = dnorm, args = list(mean = 0, sd = 2), linewidth = 2, color = \"#FF6B2B\") +\n  geom_vline(aes(xintercept = 0), color = \"#FF6B2B\", lty = 2, linewidth = 2) +\n  stat_function(geom = \"line\", n = 100, fun = dnorm, args = list(mean = 3, sd = 0.5), linewidth = 2, color = \"#00A38D\") +\n  geom_vline(aes(xintercept = 3), color = \"#00A38D\", lty = 2, linewidth = 2) +\n  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.8)) +\n  theme_void() +\n  theme(plot.margin = unit(c(1, 1, 1, 1), \"cm\"))\n\nsmall/big/unequal\n```\n\n::: {.cell-output-display}\n![](lecture_week-04_files/figure-html/unnamed-chunk-18-1.png){fig-align='center' width=768}\n:::\n:::\n\n\n\ndemonstration of power analysis:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(pwr)\n\npwr.t.test(n = NULL, d = 0.5, sig.level = 0.05, power = 0.95)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n     Two-sample t test power calculation \n\n              n = 104.9279\n              d = 0.5\n      sig.level = 0.05\n          power = 0.95\n    alternative = two.sided\n\nNOTE: n is number in *each* group\n```\n\n\n:::\n\n```{.r .cell-code}\npwr.t.test(n = NULL, d = 0.7, sig.level = 0.05, power = 0.80)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n     Two-sample t test power calculation \n\n              n = 33.02457\n              d = 0.7\n      sig.level = 0.05\n          power = 0.8\n    alternative = two.sided\n\nNOTE: n is number in *each* group\n```\n\n\n:::\n:::\n\n\n\nU statistic:\n$$\n\\begin{align}\nU_1 &= \\Sigma R_1 - n_1(n_1 + 1)/2 = 17 - 5(5+1)/2 = 2 \\\\\nU_2 &= \\Sigma R_2 - n_2(n_2 + 1)/2 = 38 - 5(5+1)/2 = 23\n\\end{align}\n$$\n\n\n::: {.cell}\n\n```{.r .cell-code}\nSample1 <- c(1.1, 2.4, 1.8, 0.4, 1.6)\nSample2 <- c(5.4, 3.1, 2.3, 1.9, 4.2)\nwilcox.test(Sample1, Sample2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tWilcoxon rank sum exact test\n\ndata:  Sample1 and Sample2\nW = 2, p-value = 0.03175\nalternative hypothesis: true location shift is not equal to 0\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# for a comparison of one group against a theoretical median\nwilcox.test(SampleA, mu = theoretical)\n\n# for a comparison of two groups\nwilcox.test(SampleA, SampleB, paired = TRUE)\n```\n:::\n\n\n\nbalanced design using Student's t:\n\n$$\n\\begin{align}\nSE_{\\bar{x}_A-\\bar{x}_B} &= s_p\\sqrt{\\frac{1}{n_A} + \\frac{1}{n_B}} \\\\\nScenario 1 &: s_p\\sqrt{\\frac{1}{5} + \\frac{1}{25}} = s_p*0.49 \\\\\nScenario 2 &: s_p\\sqrt{\\frac{1}{15} + \\frac{1}{15}} = s_p*0.37\n\\end{align}\n$$\n\n\n\n\n",
    "supporting": [
      "lecture_week-04_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}