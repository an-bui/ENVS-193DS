{
  "hash": "64787c14a91a9d5f3fbb2ccefbba8d01",
  "result": {
    "markdown": "---\ntitle: \"Week 7 figures - Lectures 12 and 13\"\neditor: source\nfreeze: auto\nexecute:\n  message: false\n  warning: false\nformat:\n  html: \n    code-fold: true\nauthor:\n  - name: An Bui\n    url: https://an-bui.com/\n    affiliation: UC Santa Barbara, Ecology, Evolution, and Marine Biology\n    affiliation-url: https://www.eemb.ucsb.edu/\npublished-title: \"Lecture date\"\ndate: 2024-05-13\ndate-modified: last-modified\ncategories: []\ncitation:\n  url: https://spring-2024.envs-193ds.com/lecture/lecture_week-07.html\n---\n\n::: {.cell}\n\n```{.r .cell-code}\n# cleaning\nlibrary(tidyverse)\n\n# visualization\ntheme_set(theme_classic() +\n            theme(panel.grid = element_blank(),\n                  axis.text = element_text(size = 18),\n                  axis.title = element_text(size = 18),\n                  text = element_text(family = \"Lato\")))\nlibrary(patchwork)\nlibrary(ggeffects)\nlibrary(flextable)\n\n# data\nlibrary(palmerpenguins)\n\n# analysis\nlibrary(car)\nlibrary(performance)\nlibrary(broom)\n```\n:::\n\n\n# what is a residual?\n\n$$\nresidual = y_i - \\hat{y}\n$$\n\n$$\nSS_{residuals} = (-1)^2 + (4)^2 + (-2)^2 + (-3)^2 = 30\n$$\n# R2\n\n$$\n\\begin{align}\nR^2 &= 1 - \\frac{\\sum_{i = 1}^{n}(y_i - \\hat{y})^2}{\\sum_{i = 1}^{n}(y_i - \\bar{y})^2} \\\\\n&= 1 - \\frac{SS_{residuals}}{SS_{total}} \n\\end{align}\n$$\n\n# linear model equation\n$$\n\\begin{align}\ny &= mx + b \\\\\ny &= b_1x + b_0 + \\epsilon = b_0 + b_1x + \\epsilon \\\\\ny &= \\beta_1x + \\beta_0 + \\epsilon = \\beta_0 + \\beta_1x + \\epsilon\n\\end{align}\n$$\n\n# linear model hypotheses\n$$\n\\begin{align}\nH_0 &: \\beta_1 = 0 \\\\\nH_A &: \\beta_1 \\not = 0\n\\end{align}\n$$\n\n# what are we doing when we fit a linear model?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(666)\ndata <- cbind(x = 1:5, y = rnorm(5, mean = 2, sd = 1)*1:5) %>% \n  as.data.frame()\n\nnoline <- ggplot(data, aes(x = x, y = y)) +\n  geom_point(size = 5, color = \"darkgreen\", fill = \"slategrey\", shape = 21, stroke = 3) +\n  theme_classic() +\n  labs(x = \"Predictor\", y = \"Response\") +\n  theme(text = element_text(size = 14))\n\nopt1 <- ggplot(data, aes(x = x, y = y)) +\n  geom_point(size = 5, color = \"darkgreen\", fill = \"slategrey\", shape = 21, stroke = 3) +\n  geom_function(fun = function(x) 2*x, color = \"coral2\", linewidth = 2, lty = 2) +\n  theme_classic() +\n  labs(x = \"Predictor\", y = \"Response\") +\n  theme(text = element_text(size = 14))\n\nopt2 <- ggplot(data, aes(x = x, y = y)) +\n  geom_point(size = 5, color = \"darkgreen\", fill = \"slategrey\", shape = 21, stroke = 3) +\n  geom_function(fun = function(x) -2*x + 10, color = \"coral2\", linewidth = 2, lty = 2) +\n  theme_classic() +\n  labs(x = \"Predictor\", y = \"Response\") +\n  theme(text = element_text(size = 14))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nnoline\n```\n\n::: {.cell-output-display}\n![](lecture_week-07_files/figure-html/noline-plot-1.png){width=672}\n:::\n:::\n\n::: {.cell fig.wdith='8'}\n\n```{.r .cell-code}\nopt1 / opt2\n```\n\n::: {.cell-output-display}\n![](lecture_week-07_files/figure-html/option-plot-1.png){width=672}\n:::\n:::\n\n\n\n# actual linear relationship example\n\n## generating data and model\n\n\n::: {.cell}\n\n```{.r .cell-code}\nx_lm <- seq(from = 1, to = 30, by = 1)\n\nset.seed(666)\ny_lm <- round(runif(length(x_lm), min = 1, max = 1.5), 1)*x_lm + runif(length(x_lm), min = 1, max = 10)\n\ndf_lm <- cbind(\n  x = x_lm,\n  y = y_lm\n) %>% \n  as_tibble() %>% \n  mutate(outlier = case_when(\n    rownames(.) %in% c(23, 27, 28) ~ \"outlier\",\n    TRUE ~ \"ok\"\n  ))\n```\n:::\n\n\n## model summaries\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel1 <- lm(y ~ x, data = df_lm)\nmodel1\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = y ~ x, data = df_lm)\n\nCoefficients:\n(Intercept)            x  \n      6.404        1.156  \n```\n:::\n\n```{.r .cell-code}\nsummary(model1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = y ~ x, data = df_lm)\n\nResiduals:\n   Min     1Q Median     3Q    Max \n-8.323 -1.020  0.002  2.393  6.645 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)   6.4043     1.3421   4.772 5.17e-05 ***\nx             1.1561     0.0756  15.293 4.02e-15 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 3.584 on 28 degrees of freedom\nMultiple R-squared:  0.8931,\tAdjusted R-squared:  0.8893 \nF-statistic: 233.9 on 1 and 28 DF,  p-value: 4.021e-15\n```\n:::\n\n```{.r .cell-code}\nanova(model1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Variance Table\n\nResponse: y\n          Df  Sum Sq Mean Sq F value    Pr(>F)    \nx          1 3003.92 3003.92  233.87 4.021e-15 ***\nResiduals 28  359.64   12.84                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\nmodel1_nooutliers <- lm(y ~ x, data = df_lm %>% filter(outlier == \"ok\"))\nsummary(model1_nooutliers)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = y ~ x, data = df_lm %>% filter(outlier == \"ok\"))\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-6.6611 -1.2596 -0.5039  1.6229  4.7197 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  6.12314    1.02352   5.982 3.02e-06 ***\nx            1.20027    0.06177  19.431  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 2.668 on 25 degrees of freedom\nMultiple R-squared:  0.9379,\tAdjusted R-squared:  0.9354 \nF-statistic: 377.6 on 1 and 25 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\n$$\n\\begin{align}\nR^2 &= 1 - \\frac{SS_{residuals}}{SS_{total}} \\\\\n&= 1 - \\frac{359.64}{359.64 + 3003.92} \\\\\n&= 0.8931\n\\end{align}\n$$\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# if using quarto, don't label chunk with a table... so weird\nanova_tbl <- broom::tidy(anova(model1)) %>% \n  mutate(across(where(is.numeric), ~ round(.x, digits = 2))) %>% \n  mutate(p.value = case_when(\n    p.value < 0.001 ~ \"< 0.001\"\n  )) \n\nflextable(anova_tbl) %>% \n  set_header_labels(term = \"Term\", \n                    df = \"Degrees of freedom\", \n                    sumsq = \"Sum of squares\", \n                    meansq = \"Mean squares\", \n                    statistic = \"F-statistic\", \n                    p.value = \"p-value\") %>% \n  set_table_properties(layout = \"autofit\", width = 0.8)\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"tabwid\"><style>.cl-ac5c1cf6{table-layout:auto;width:80%;}.cl-ac4af476{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-ac5a2284{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-ac5a228e{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-ac5a2bd0{background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ac5a2bda{background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ac5a2bdb{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ac5a2bdc{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ac5a2be4{background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ac5a2be5{background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-ac5c1cf6'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-ac5a2bd0\"><p class=\"cl-ac5a2284\"><span class=\"cl-ac4af476\">Term</span></p></th><th class=\"cl-ac5a2bda\"><p class=\"cl-ac5a228e\"><span class=\"cl-ac4af476\">Degrees of freedom</span></p></th><th class=\"cl-ac5a2bda\"><p class=\"cl-ac5a228e\"><span class=\"cl-ac4af476\">Sum of squares</span></p></th><th class=\"cl-ac5a2bda\"><p class=\"cl-ac5a228e\"><span class=\"cl-ac4af476\">Mean squares</span></p></th><th class=\"cl-ac5a2bda\"><p class=\"cl-ac5a228e\"><span class=\"cl-ac4af476\">F-statistic</span></p></th><th class=\"cl-ac5a2bd0\"><p class=\"cl-ac5a2284\"><span class=\"cl-ac4af476\">p-value</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ac5a2bdb\"><p class=\"cl-ac5a2284\"><span class=\"cl-ac4af476\">x</span></p></td><td class=\"cl-ac5a2bdc\"><p class=\"cl-ac5a228e\"><span class=\"cl-ac4af476\">1</span></p></td><td class=\"cl-ac5a2bdc\"><p class=\"cl-ac5a228e\"><span class=\"cl-ac4af476\">3,003.92</span></p></td><td class=\"cl-ac5a2bdc\"><p class=\"cl-ac5a228e\"><span class=\"cl-ac4af476\">3,003.92</span></p></td><td class=\"cl-ac5a2bdc\"><p class=\"cl-ac5a228e\"><span class=\"cl-ac4af476\">233.87</span></p></td><td class=\"cl-ac5a2bdb\"><p class=\"cl-ac5a2284\"><span class=\"cl-ac4af476\">&lt; 0.001</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ac5a2be4\"><p class=\"cl-ac5a2284\"><span class=\"cl-ac4af476\">Residuals</span></p></td><td class=\"cl-ac5a2be5\"><p class=\"cl-ac5a228e\"><span class=\"cl-ac4af476\">28</span></p></td><td class=\"cl-ac5a2be5\"><p class=\"cl-ac5a228e\"><span class=\"cl-ac4af476\">359.64</span></p></td><td class=\"cl-ac5a2be5\"><p class=\"cl-ac5a228e\"><span class=\"cl-ac4af476\">12.84</span></p></td><td class=\"cl-ac5a2be5\"><p class=\"cl-ac5a228e\"><span class=\"cl-ac4af476\"></span></p></td><td class=\"cl-ac5a2be4\"><p class=\"cl-ac5a2284\"><span class=\"cl-ac4af476\"></span></p></td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n\n## model plots\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel1_pred <- ggpredict(model1, terms = ~ x)\nmodel1_nooutliers_pred <- ggpredict(model1_nooutliers, terms = ~ x)\n\nmodel1_plot_noline <- ggplot(data = df_lm, aes(x = x, y = y)) +\n  geom_point(shape = 19, size = 3, color = \"cornflowerblue\") +\n  theme_classic() +\n  theme(text = element_text(size = 14))\n\nmodel1_plot <- ggplot(data = df_lm, aes(x = x, y = y)) +\n  geom_point(shape = 19, size = 3, color = \"cornflowerblue\") +\n  geom_line(data = model1_pred, aes(x = x, y = predicted), linewidth = 1) +\n  theme_classic() +\n  theme(text = element_text(size = 14))\n\nmodel1_plot_nooutliers <- ggplot(data = df_lm %>% filter(outlier == \"ok\"), aes(x = x, y = y)) +\n  geom_point(aes(color = outlier), shape = 19, size = 3) +\n  scale_color_manual(values = c(\"ok\" = \"cornflowerblue\", \"outlier\" = \"red\")) +\n  geom_line(data = model1_nooutliers_pred, aes(x = x, y = predicted), linewidth = 1) +\n  theme_classic() +\n  theme(text = element_text(size = 14),\n        legend.position = \"none\") \n```\n:::\n\n\n# exponential growth example\n\n\n::: {.cell}\n\n```{.r .cell-code}\nx_ex <- seq(from = 5, to = 9, length = 30)\n\ny_ex <- exp(x_ex)\n\ndf_ex <- cbind(\n  x = x_ex,\n  y = exp(x_ex)\n) %>% \n  as_tibble()\n\nlm_ex <- lm(y ~ x, data = df_ex)\n\nlm_ex\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = y ~ x, data = df_ex)\n\nCoefficients:\n(Intercept)            x  \n      -9431         1642  \n```\n:::\n:::\n\n\n## model summary\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(lm_ex)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = y ~ x, data = df_ex)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-1081.0  -843.2  -226.3   660.5  2756.1 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  -9431.3     1111.3  -8.486 3.16e-09 ***\nx             1642.0      156.5  10.492 3.30e-11 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 1023 on 28 degrees of freedom\nMultiple R-squared:  0.7972,\tAdjusted R-squared:   0.79 \nF-statistic: 110.1 on 1 and 28 DF,  p-value: 3.298e-11\n```\n:::\n:::\n\n\n## model plots\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlm_pred <- ggpredict(lm_ex, terms = ~x)\n\nex_plot_noline <- ggplot(df_ex, aes(x= x, y = y)) +\n  geom_point(shape = 17, size = 3, color = \"orange\") +\n  theme_classic() +\n  theme(text = element_text(size = 14))\n\nex_plot <- ggplot(df_ex, aes(x= x, y = y)) +\n  geom_point(shape = 17, size = 3, color = \"orange\") +\n  geom_line(data = lm_pred, aes(x = x, y = predicted), linewidth = 1) +\n  theme_classic() +\n  theme(text = element_text(size = 14))\n```\n:::\n\n\n# diagnostic plots\n\n::: {.cell}\n\n```{.r .cell-code}\npar(mfrow = c(2, 4))\nplot(model1, which = c(1), col = \"cornflowerblue\", pch = 19)\nplot(lm_ex, which = c(1), col = \"orange\", pch = 17)\nplot(model1, which = c(2), col = \"cornflowerblue\", pch = 19)\nplot(lm_ex, which = c(2), col = \"orange\", pch = 17)\nplot(model1, which = c(3), col = \"cornflowerblue\", pch = 19)\nplot(lm_ex, which = c(3), col = \"orange\", pch = 17)\nplot(model1, which = c(5), col = \"cornflowerblue\", pch = 19)\nplot(lm_ex, which = c(5), col = \"orange\", pch = 17)\n```\n\n::: {.cell-output-display}\n![](lecture_week-07_files/figure-html/diagnostics-1.png){width=672}\n:::\n\n```{.r .cell-code}\ndev.off()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nnull device \n          1 \n```\n:::\n:::\n\n\n# comparison plots\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel1_plot_noline + ex_plot_noline\n```\n\n::: {.cell-output-display}\n![](lecture_week-07_files/figure-html/plots-for-comparison-1.png){width=672}\n:::\n\n```{.r .cell-code}\nmodel1_plot + ex_plot\n```\n\n::: {.cell-output-display}\n![](lecture_week-07_files/figure-html/plots-for-comparison-2.png){width=672}\n:::\n:::\n\n\n# correlation?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nx <- x_lm\ny <- y_lm\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncor.test(x, y, method = \"pearson\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tPearson's product-moment correlation\n\ndata:  x and y\nt = 15.293, df = 28, p-value = 4.021e-15\nalternative hypothesis: true correlation is not equal to 0\n95 percent confidence interval:\n 0.8866210 0.9737646\nsample estimates:\n      cor \n0.9450274 \n```\n:::\n:::\n\n\n## formula for Pearson's correlation\n\n$$\nr = \\frac{\\sum(x_i - \\bar{x})(y_i - \\bar{y})}{\\sqrt{\\sum(x_i-\\bar{x})^2}\\sqrt{\\sum(y_i - \\bar{y})^2}}\n$$\n\n\n## test statistic for pearson correlation\n\n$$\n\\begin{align}\nt &= \\frac{r\\sqrt{n - 2}}{\\sqrt{1-r^2}} \\\\\ndf &= n -2\n\\end{align}\n$$\n\nuses a t-distribution\n\n## no correlation but clear relationship\n\n\n::: {.cell}\n\n```{.r .cell-code}\nx_lm <- seq(from = 1, to = 30, length.out = 50)\n# y = a( x – h) 2 + k\ndf_para <- cbind(\n  x = x_lm,\n  y = 0.1*(x_lm - 15)^2 + 12\n) %>% \n  as_tibble()\n\nggplot(df_para, aes(x = x, y = y)) +\n  geom_point(size = 3) +\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](lecture_week-07_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n\n```{.r .cell-code}\ncor.test(df_para$x, df_para$y, method = \"pearson\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tPearson's product-moment correlation\n\ndata:  df_para$x and df_para$y\nt = 0.90749, df = 48, p-value = 0.3687\nalternative hypothesis: true correlation is not equal to 0\n95 percent confidence interval:\n -0.1540408  0.3939806\nsample estimates:\n      cor \n0.1298756 \n```\n:::\n:::\n",
    "supporting": [
      "lecture_week-07_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}