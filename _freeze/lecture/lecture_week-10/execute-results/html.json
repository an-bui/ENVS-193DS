{
  "hash": "b8c7c19c90332f48d6f9c930d326f0a0",
  "result": {
    "markdown": "---\ntitle: \"Week 10 figures - Lectures 17 and 18\"\neditor: source\nfreeze: auto\nexecute:\n  message: false\n  warning: false\nformat:\n  html: \n    code-fold: true\nauthor:\n  - name: An Bui\n    url: https://an-bui.com/\n    affiliation: UC Santa Barbara, Ecology, Evolution, and Marine Biology\n    affiliation-url: https://www.eemb.ucsb.edu/\npublished-title: \"Lecture date\"\ndate: 2024-06-03\ndate-modified: last-modified\ncategories: []\ncitation:\n  url: https://spring-2024.envs-193ds.com/lecture/lecture_week-10.html\n---\n\n::: {.cell}\n\n```{.r .cell-code}\n# cleaning\nlibrary(tidyverse)\n\n# visualization\ntheme_set(theme_classic() +\n            theme(panel.grid = element_blank(),\n                  axis.text = element_text(size = 18),\n                  axis.title = element_text(size = 18),\n                  text = element_text(family = \"Lato\")))\nlibrary(patchwork)\nlibrary(ggeffects)\nlibrary(flextable)\nlibrary(GGally)\nlibrary(equatiomatic)\n\n# data\nlibrary(palmerpenguins)\n\n# analysis\nlibrary(car)\nlibrary(performance)\nlibrary(broom)\nlibrary(DHARMa)\nlibrary(MuMIn)\nlibrary(lmtest)\n```\n:::\n\n\n# math notation\n\n## simple linear regression\n\n$$\nE[y_i] = a + bx_i\n$$\n\n$$\nvar[y_i] = s^2\n$$\n\n## generalized form:\n\n$$\nE[y_i] = a + bx_i\n$$\n\n$$\nvar[y_i] = v(E[y_i])\n$$\n\n# GLM structure using Gaussian example\n\n## random component\n\n$$\nY_i \\sim N(\\mu_i, \\sigma^2)\n$$\n\n## systematic component\n\n$$\n\\eta_i = \\sum^{p-1}_{n = 0}\\beta_jx_{ij}\n$$\n\n## link\n\n$$\ng(\\mu_i) = \\eta_i\n$$\n\n# negative binomial example\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(666)\nnbinom_df <- bind_cols(\n  size1 = rnbinom(mu = 10, size = 1, n = 100),\n  size10 = rnbinom(mu = 10, size = 10, n = 100),\n  size100 = rnbinom(mu = 10, size = 100, n = 100)\n)\n\nggplot(data.frame(x = 1:20), aes(x)) +\n  stat_function(geom = \"point\", n = 20, fun = dnbinom, args = list(mu = 4, x = 5), size = 2) +\n  stat_function(geom = \"line\", n = 20, fun = dnbinom, args = list(mu = 4, x = 5))\n```\n\n::: {.cell-output-display}\n![](lecture_week-10_files/figure-html/nbinom-fig-1.png){width=672}\n:::\n\n```{.r .cell-code}\nsize1 <- ggplot(nbinom_df, aes(x = size1)) +\n  geom_histogram(bins = 8, fill = \"cornflowerblue\", color = \"grey8\") +\n  scale_y_continuous(expand = c(0, 0), limits = c(0, 40)) +\n  theme_classic() +\n  labs(title = expression(mu~\"= 10, k = 1\")) +\n  theme(axis.title.x = element_blank())\n\nsize10 <- ggplot(nbinom_df, aes(x = size10)) +\n  geom_histogram(bins = 8, fill = \"cornflowerblue\", color = \"grey8\") +\n  scale_y_continuous(expand = c(0, 0), limits = c(0, 40)) +\n  theme_classic() +\n  labs(title = expression(mu~\"= 10, k = 10\")) +\n  theme(axis.title.x = element_blank())\n\nsize100 <- ggplot(nbinom_df, aes(x = size100)) +\n  geom_histogram(bins = 8, fill = \"cornflowerblue\", color = \"grey8\") +\n  scale_y_continuous(expand = c(0, 0), limits = c(0, 40)) +\n  theme_classic() +\n  labs(title = expression(mu~\"= 10, k = 100\")) +\n  theme(axis.title.x = element_blank())\n\nsize1 + size10 + size100\n```\n\n::: {.cell-output-display}\n![](lecture_week-10_files/figure-html/nbinom-fig-2.png){width=672}\n:::\n:::\n\n\n# poisson example\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(666)\npois_df <- bind_cols(\n  lambda1 = rpois(lambda = 1, n = 100),\n  lambda5 = rpois(lambda = 5, n = 100),\n  lambda20 = rpois(lambda = 20, n = 100)\n)\n\nlambda1 <- ggplot(pois_df, aes(x = lambda1)) +\n  geom_histogram(bins = 8, fill = \"darkorange\", color = \"grey8\") +\n  scale_y_continuous(expand = c(0, 0), limits = c(0, 40)) +\n  theme_classic() +\n  labs(title = expression(lambda~\"= 1\")) +\n  theme(axis.title.x = element_blank())\n\nlambda5 <- ggplot(pois_df, aes(x = lambda5)) +\n  geom_histogram(bins = 8, fill = \"darkorange\", color = \"grey8\") +\n  scale_y_continuous(expand = c(0, 0), limits = c(0, 40)) +\n  theme_classic() +\n  labs(title = expression(lambda~\"= 5\")) +\n  theme(axis.title.x = element_blank())\n\nlambda20 <- ggplot(pois_df, aes(x = lambda20)) +\n  geom_histogram(bins = 8, fill = \"darkorange\", color = \"grey8\") +\n  scale_y_continuous(expand = c(0, 0), limits = c(0, 40)) +\n  theme_classic() +\n  labs(title = expression(lambda~\"= 20\")) +\n  theme(axis.title.x = element_blank())\n\nlambda1 + lambda5 + lambda20\n```\n\n::: {.cell-output-display}\n![](lecture_week-10_files/figure-html/pois-fig-1.png){width=672}\n:::\n:::\n\n\n\n# simpson's paradox\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbill_model <- lm(bill_length_mm ~ bill_depth_mm, data = penguins)\n\npar(mfrow = c(2, 2))\nplot(bill_model)\n```\n\n::: {.cell-output-display}\n![](lecture_week-10_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n\n```{.r .cell-code}\nsummary(bill_model)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = bill_length_mm ~ bill_depth_mm, data = penguins)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-12.8949  -3.9042  -0.3772   3.6800  15.5798 \n\nCoefficients:\n              Estimate Std. Error t value Pr(>|t|)    \n(Intercept)    55.0674     2.5160  21.887  < 2e-16 ***\nbill_depth_mm  -0.6498     0.1457  -4.459 1.12e-05 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 5.314 on 340 degrees of freedom\n  (2 observations deleted due to missingness)\nMultiple R-squared:  0.05525,\tAdjusted R-squared:  0.05247 \nF-statistic: 19.88 on 1 and 340 DF,  p-value: 1.12e-05\n```\n:::\n\n```{.r .cell-code}\nconfint(bill_model)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                   2.5 %     97.5 %\n(Intercept)   50.1185795 60.0161600\nbill_depth_mm -0.9364867 -0.3631844\n```\n:::\n\n```{.r .cell-code}\nbill_model_preds <- ggpredict(bill_model, terms = \"bill_depth_mm\")\n\nmodel_plot <- ggplot(penguins, aes(x = bill_depth_mm, y = bill_length_mm)) +\n  geom_point() +\n  geom_line(data = bill_model_preds, aes(x = x, y = predicted), color = \"blue\", linewidth = 2) +\n  geom_ribbon(data = bill_model_preds, aes(x = x, y = predicted, ymin = conf.low, ymax = conf.high), alpha = 0.2) +\n  theme_classic() +\n  labs(x = \"Bill depth (mm)\", y = \"Bill length (mm)\")\n```\n:::\n\n\n$$\nlength = -0.65*depth + 55.07\n$$\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbill_model2 <- lm(bill_length_mm ~ bill_depth_mm*species, data = penguins)\npar(mfrow = c(2, 2))\nplot(bill_model2)\n```\n\n::: {.cell-output-display}\n![](lecture_week-10_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n\n```{.r .cell-code}\nsummary(bill_model2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = bill_length_mm ~ bill_depth_mm * species, data = penguins)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-7.7888 -1.5415  0.0575  1.5873 10.3590 \n\nCoefficients:\n                               Estimate Std. Error t value Pr(>|t|)    \n(Intercept)                     23.0681     3.0165   7.647 2.18e-13 ***\nbill_depth_mm                    0.8570     0.1641   5.224 3.08e-07 ***\nspeciesChinstrap                -9.6402     5.7154  -1.687 0.092590 .  \nspeciesGentoo                   -5.8386     4.5353  -1.287 0.198850    \nbill_depth_mm:speciesChinstrap   1.0651     0.3100   3.435 0.000666 ***\nbill_depth_mm:speciesGentoo      1.1637     0.2789   4.172 3.84e-05 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 2.445 on 336 degrees of freedom\n  (2 observations deleted due to missingness)\nMultiple R-squared:  0.8024,\tAdjusted R-squared:  0.7995 \nF-statistic: 272.9 on 5 and 336 DF,  p-value: < 2.2e-16\n```\n:::\n\n```{.r .cell-code}\nlrtest(bill_model2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLikelihood ratio test\n\nModel 1: bill_length_mm ~ bill_depth_mm * species\nModel 2: bill_length_mm ~ 1\n  #Df   LogLik Df  Chisq Pr(>Chisq)    \n1   7  -787.97                         \n2   2 -1065.28 -5 554.62  < 2.2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\nanova(bill_model2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Variance Table\n\nResponse: bill_length_mm\n                       Df Sum Sq Mean Sq F value    Pr(>F)    \nbill_depth_mm           1  561.6   561.6  93.965 < 2.2e-16 ***\nspecies                 2 7460.3  3730.2 624.151 < 2.2e-16 ***\nbill_depth_mm:species   2  134.3    67.1  11.232 1.898e-05 ***\nResiduals             336 2008.1     6.0                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\nwaldtest(bill_model2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nWald test\n\nModel 1: bill_length_mm ~ bill_depth_mm * species\nModel 2: bill_length_mm ~ 1\n  Res.Df Df      F    Pr(>F)    \n1    336                        \n2    341 -5 272.95 < 2.2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\nplot(ggpredict(bill_model2, terms = c(\"bill_depth_mm\", \"species\")), add.data = TRUE)\n```\n\n::: {.cell-output-display}\n![](lecture_week-10_files/figure-html/unnamed-chunk-3-2.png){width=672}\n:::\n\n```{.r .cell-code}\nbill_model2_preds <- ggpredict(bill_model2, terms = c(\"bill_depth_mm\", \"species\"))\n\nmodel2_plot <- ggplot(penguins, aes(x = bill_depth_mm, y = bill_length_mm)) +\n  geom_point(aes(color = species)) +\n  geom_line(data = bill_model2_preds, aes(x = x, y = predicted, color = group), linewidth = 2) +\n  geom_ribbon(data = bill_model2_preds, aes(x = x, y = predicted, ymin = conf.low, ymax = conf.high, fill = group), alpha = 0.2) +\n  scale_color_manual(values = c(\"cornflowerblue\", \"darkgreen\", \"darkorange\")) +\n  scale_fill_manual(values = c(\"cornflowerblue\", \"darkgreen\", \"darkorange\")) +\n  theme_classic() +\n  labs(x = \"Bill depth (mm)\", y = \"Bill length (mm)\",\n       color = \"Species\", fill = \"Species\") +\n  theme(legend.position = c(0.2, 0.8))\n\nmodel_plot + model2_plot\n```\n\n::: {.cell-output-display}\n![](lecture_week-10_files/figure-html/unnamed-chunk-3-3.png){width=672}\n:::\n\n```{.r .cell-code}\nextract_eq(bill_model)\n```\n\n::: {.cell-output-display}\n$$\n\\operatorname{bill\\_length\\_mm} = \\alpha + \\beta_{1}(\\operatorname{bill\\_depth\\_mm}) + \\epsilon\n$$\n:::\n:::\n\n\n\n$$\n\\operatorname{bill\\_length\\_mm} = \\alpha + \\beta_{1}(\\operatorname{bill\\_depth\\_mm}) + \\beta_{2}(\\operatorname{species}_{\\operatorname{Chinstrap}}) + \\beta_{3}(\\operatorname{species}_{\\operatorname{Gentoo}}) + \\beta_{4}(\\operatorname{bill\\_depth\\_mm} \\times \\operatorname{species}_{\\operatorname{Chinstrap}}) + \\beta_{5}(\\operatorname{bill\\_depth\\_mm} \\times \\operatorname{species}_{\\operatorname{Gentoo}}) + \\epsilon\n$$\n\n$$\n\\operatorname{bill\\_length\\_mm} = \\alpha + \\beta_{1}(\\operatorname{bill\\_depth\\_mm}) + \\epsilon \n$$\n\n\n\n\n\n",
    "supporting": [
      "lecture_week-10_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}