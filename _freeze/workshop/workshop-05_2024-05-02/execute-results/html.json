{
  "hash": "3333179665c24ee2cb56032c04a85dea",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Coding workshop: Week 5\"\ndescription: \"Parametric and non-parametric tests\"\nfreeze: auto\nauthor:\n  - name: An Bui\n    url: https://an-bui.com/\n    affiliation: UC Santa Barbara, Ecology, Evolution, and Marine Biology\n    affiliation-url: https://www.eemb.ucsb.edu/\npublished-title: \"Workshop date\"\ndate: 2024-05-02\ndate-modified: last-modified\ncategories: [tidyverse, lterdatasampler, effectsize, rstatix, car, shapiro.test, leveneTest, aov, summary, TukeyHSD, eta_squared, kruskal.test, dunn_test, kruskal_effectsize, read_csv, pipe (%>%) operator, select, rename, ggplot, geom_histogram, geom_qq, geom_qq_line, facet_wrap, group_by, reframe]\nformat:\n  html:\n    toc: true\n    toc-depth: 5\n---\n\n\n## 1. Summary\n\n### Packages\n- `tidyverse`  \n- `lterdatasampler`  \n- `effectsize`  \n- `rstatix`  \n- `car`  \n\n### Operations\n\n#### New functions\n- do a Shapiro-Wilk test using `shapiro.test()`  \n- do a Levene's test using `car::leveneTest()`  \n- do an ANOVA using `aov()`  \n- look for more information from model results using `summary()`  \n- do post-hoc Tukey test using `TukeyHSD()`  \n- calculate effect size for ANOVA using `effectsize::eta_squared()`  \n- do Kruskal-Wallis test using `kruskal.test()`  \n- do Dunn's test using `rstatix::dunn_test()`  \n- calculate effect size for Kruskal-Wallis test using `rstatix::kruskal_effsize()`\n\n#### Review\n- read in data using `read_csv()`  \n- chain functions together using ` %>% `  \n- select columns using `select()`  \n- rename columns using `rename()`  \n- visualize data using `ggplot()`  \n- create histograms using `geom_histogram()`  \n- visualize QQ plots using `geom_qq()` and `geom_qq_line()`  \n- create multi-panel plots using `facet_wrap()`  \n- group data using `group_by()`  \n- summarize data using `reframe()`  \n\n### Data sources\n\nThe Plum Island Ecosystem fiddler crab data is from `lterdatasampler` (data info [here](https://lter.github.io/lterdatasampler/articles/pie_crab_vignette.html)). The ramen ratings data set is a Tidy Tuesday dataset - see more about the data and its source [here](https://github.com/rfordatascience/tidytuesday/tree/master/data/2019/2019-06-04).\n\n## 2. Code\n\n### 1. Packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(lterdatasampler)\nlibrary(effectsize)\nlibrary(rstatix)\nlibrary(car)\n```\n:::\n\n\n### 2. Parametric tests\n\n#### a. Cleaning and wrangling\n\n\n::: {.cell}\n\n```{.r .cell-code}\npie_crab_clean <- pie_crab %>% # start with the pie_crab dataset\n  filter(site %in% c(\"CC\", \"ZI\", \"VCR\")) %>% # filter for Cape Cod, Zeke's Island, Virginia Coastal\n  select(site, name, size) %>% # select columns of interest\n  rename(site_code = site, # rename site to be site_code\n         site_name = name) # rename name to be site_name\n```\n:::\n\n\n#### b. Exploring the data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(pie_crab_clean, # use the clean data set\n       aes(x = site_name, # x-axis\n           y = size)) + # y-axis\n  geom_jitter(width = 0.2, # jitter points horizontally\n              height = 0) + # don't jitter points vertically\n  theme_minimal() # cleaner plot theme\n```\n\n::: {.cell-output-display}\n![](workshop-05_2024-05-02_files/figure-html/crab-explore-viz-1.png){width=672}\n:::\n:::\n\n\nIs there a difference in crab size between the three sites?  \n\n**insert response here**\n\n#### c. Check 1: normally distributed variable\n\nDo this with a histogram:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = pie_crab_clean, # using the clean data frame\n       aes(x = size)) + # x-axis\n  geom_histogram(bins = 9) + # make a histogram\n  facet_wrap(~ site_name, # make multiple panels by site\n             scales = \"free\") # let the axes vary between panels\n```\n\n::: {.cell-output-display}\n![](workshop-05_2024-05-02_files/figure-html/crab-histogram-1.png){width=672}\n:::\n:::\n\n\nAnd a qq plot:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = pie_crab_clean, # using the clean data frame\n       aes(sample = size)) + # y-axis\n  geom_qq_line() + # making a reference line\n  geom_qq() + # making the qq\n  facet_wrap(~ site_name, # make multiple panels by site\n             scales = \"free\") # let axes vary between panels\n```\n\n::: {.cell-output-display}\n![](workshop-05_2024-05-02_files/figure-html/crab-qq-1.png){width=672}\n:::\n:::\n\n\nWhat are the outcomes of your visual checks?  \n\n**summarize outcomes here**  \n\nDo Shapiro-Wilk tests:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncc_crabs <- pie_crab_clean %>% # use the original data set\n  filter(site_code == \"CC\") %>% # filter to only include Cape Cod\n  pull(size) # extract the size column as a vector\n\nvcr_crabs <- pie_crab_clean %>% \n  filter(site_code == \"VCR\") %>% # filter to only include Virginia Coastal\n  pull(size)\n\nzi_crabs <- pie_crab_clean %>% \n  filter(site_code == \"ZI\") %>% # filter to only include Zeke's Island\n  pull(size)\n\n# do the Shapiro-Wilk tests\nshapiro.test(cc_crabs)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tShapiro-Wilk normality test\n\ndata:  cc_crabs\nW = 0.93547, p-value = 0.09418\n```\n\n\n:::\n\n```{.r .cell-code}\nshapiro.test(vcr_crabs)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tShapiro-Wilk normality test\n\ndata:  vcr_crabs\nW = 0.94447, p-value = 0.12\n```\n\n\n:::\n\n```{.r .cell-code}\nshapiro.test(zi_crabs)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tShapiro-Wilk normality test\n\ndata:  zi_crabs\nW = 0.97446, p-value = 0.5766\n```\n\n\n:::\n:::\n\n\nWhat are the outcomes of your visual checks?  \n\n**summarize outcomes here**\n\nWhat are the outcomes of your statistical checks?  \n\n**summarize outcomes here**  \n\n#### d. Check 2: equal variances\n\nFirst, calculate the actual variances yourself:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# quick summary \npie_crab_clean %>% # use the clean data frame\n  group_by(site_name) %>% # group by site\n  reframe(var = var(size)) # calculate variance at each site\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 × 2\n  site_name                       var\n  <chr>                         <dbl>\n1 Cape Cod                       4.22\n2 Virginia Coastal Reserve LTER  8.63\n3 Zeke's Island NERR             4.04\n```\n\n\n:::\n:::\n\n\nUsing `leveneTest()` from `car`\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# do the Levene test\nleveneTest(size ~ site_name, # formula\n           data = pie_crab_clean) # data\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nLevene's Test for Homogeneity of Variance (center = median)\n      Df F value  Pr(>F)   \ngroup  2  5.0233 0.00857 **\n      89                   \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n\nWhat are the outcomes of your variance check?  \n\n**insert outcomes here**\n\n#### e. ANOVA\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# creating an object called crab_anova\ncrab_anova <- aov(size ~ site_name, # formula\n                  data = pie_crab_clean) # data\n\n# gives more information\nsummary(crab_anova)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n            Df Sum Sq Mean Sq F value  Pr(>F)    \nsite_name    2  442.2  221.10   39.56 5.1e-13 ***\nResiduals   89  497.4    5.59                    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n\nSummarize results: is there a difference in crab size between the three sites?  \n\n**insert results here**\n\n#### f. Post-hoc: Tukey HSD\n\n\n::: {.cell}\n\n```{.r .cell-code}\nTukeyHSD(crab_anova)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  Tukey multiple comparisons of means\n    95% family-wise confidence level\n\nFit: aov(formula = size ~ site_name, data = pie_crab_clean)\n\n$site_name\n                                                       diff       lwr       upr\nVirginia Coastal Reserve LTER-Cape Cod           -0.4795185 -1.974354  1.015317\nZeke's Island NERR-Cape Cod                      -4.7514709 -6.194843 -3.308099\nZeke's Island NERR-Virginia Coastal Reserve LTER -4.2719524 -5.673993 -2.869912\n                                                     p adj\nVirginia Coastal Reserve LTER-Cape Cod           0.7255994\nZeke's Island NERR-Cape Cod                      0.0000000\nZeke's Island NERR-Virginia Coastal Reserve LTER 0.0000000\n```\n\n\n:::\n:::\n\n\nWhich pairwise comparisons are actually different? Which ones are not different?  \n\n**insert results here**\n\n#### g. effect size\n\nUsing `eta_squared()` from `effectsize`\n\n\n::: {.cell}\n\n```{.r .cell-code}\neffectsize::eta_squared(crab_anova)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# Effect Size for ANOVA\n\nParameter | Eta2 |       95% CI\n-------------------------------\nsite_name | 0.47 | [0.34, 1.00]\n\n- One-sided CIs: upper bound fixed at [1.00].\n```\n\n\n:::\n:::\n\n\nWhat is the magnitude of the effect of site on crab size?  \n\n**insert results here**\n\n#### h. Putting everything together\n\nWe found a (insert effect size here) difference between sites in crab size (insert ANOVA info here). On average, crabs from Zeke's Island NERR were smaller than crabs from Cape Cod and Virginia Coastal Reserve LTER (insert Tukey HSD info here).  \n\n### 3. Non-parametric tests\n\n#### a. Set up\n\n\n::: {.cell}\n\n```{.r .cell-code}\nramen_ratings <- read_csv(\"ramen_ratings.csv\")\n```\n:::\n\n::: {.cell}\n\n:::\n\n\n#### b. Clean and wrangle the data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nramen_ratings_clean <- ramen_ratings %>% # use the ramen_ratings dataframe\n  filter(brand == \"Maruchan\") %>% # filter to only include Maruchan ramen\n  mutate(style = fct_relevel(style, \"Bowl\", \"Pack\", \"Tray\", \"Cup\")) # reorder style factor\n\n# look at the structure\nstr(ramen_ratings_clean)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\ntibble [106 × 6] (S3: tbl_df/tbl/data.frame)\n $ review_number: num [1:106] 3176 3152 3141 3124 3111 ...\n $ brand        : chr [1:106] \"Maruchan\" \"Maruchan\" \"Maruchan\" \"Maruchan\" ...\n $ variety      : chr [1:106] \"Gotsumori Shio Yakisoba\" \"QTTA Curry Ramen\" \"Thai Red Curry Udon\" \"Kitsune Udon 40th Anniversary\" ...\n $ style        : Factor w/ 4 levels \"Bowl\",\"Pack\",..: 3 4 1 1 1 4 1 1 4 3 ...\n $ country      : chr [1:106] \"Japan\" \"Japan\" \"Japan\" \"Japan\" ...\n $ stars        : num [1:106] 5 5 5 4.5 4 4 3.75 2 2.5 2.5 ...\n```\n\n\n:::\n:::\n\n\n#### c. Make a boxplot to compare star ratings across ramen styles\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = ramen_ratings_clean, # use the clean data frame\n       aes(x = style, # x-axis\n           y = stars, # y-axis\n           fill = style)) + # fill geoms by ramen style\n  geom_boxplot() + # make a boxplot\n  scale_fill_manual(values = c(\"firebrick4\", \"orange\", \"gold\", \"darkgreen\")) + # define the colors\n  theme_minimal() + # minimal theme\n  theme(legend.position = \"none\") # take out the legend\n```\n\n::: {.cell-output-display}\n![](workshop-05_2024-05-02_files/figure-html/ramen-explore-viz-1.png){width=672}\n:::\n:::\n\n\n#### d. Do the Kruskal-Wallis test\n\n\n::: {.cell}\n\n```{.r .cell-code}\nkruskal.test(stars ~ style, # formula\n             data = ramen_ratings_clean) # data\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tKruskal-Wallis rank sum test\n\ndata:  stars by style\nKruskal-Wallis chi-squared = 15.679, df = 3, p-value = 0.00132\n```\n\n\n:::\n:::\n\n\nIs there a difference in ratings between ramen styles?  \n\n**summarize results here**\n\n#### e. Do a Dunn's post-hoc test\n\nUsing `dunn_test()` from `rstatix`\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndunn_test(stars ~ style, # formula\n          data = ramen_ratings_clean) # data\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 9\n  .y.   group1 group2    n1    n2 statistic        p   p.adj p.adj.signif\n* <chr> <chr>  <chr>  <int> <int>     <dbl>    <dbl>   <dbl> <chr>       \n1 stars Bowl   Pack      33    30    -2.61  0.00898  0.0449  *           \n2 stars Bowl   Tray      33    17    -2.54  0.0112   0.0449  *           \n3 stars Bowl   Cup       33    26    -3.70  0.000213 0.00128 **          \n4 stars Pack   Tray      30    17    -0.323 0.747    0.985   ns          \n5 stars Pack   Cup       30    26    -1.16  0.244    0.733   ns          \n6 stars Tray   Cup       17    26    -0.686 0.492    0.985   ns          \n```\n\n\n:::\n:::\n\n\nWhich pairwise comparisons of ramen styles are different from each other?  \n\n**summarize results here**\n\n#### f. Calculate an effect size\n\nUsing `kruskal_effsize()` from `rstatix`\n\n\n::: {.cell}\n\n```{.r .cell-code}\nkruskal_effsize(stars ~ style, # formula\n                data = ramen_ratings_clean) # data\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 5\n  .y.       n effsize method  magnitude\n* <chr> <int>   <dbl> <chr>   <ord>    \n1 stars   106   0.124 eta2[H] moderate \n```\n\n\n:::\n:::\n\n\nWhat is the magnitude of the effect of ramen style on ratings?  \n\n**summarize results here**\n\n#### g. Putting it all together\n\nWe found a difference in ratings between ramen styles (insert KW info here). There was a large effect of style on rating (insert eta info here), with bowl-style ramen tending to be more highly rated than pack, tray, or cup style ramen (insert Dunn's post-hoc info here).\n\n",
    "supporting": [
      "workshop-05_2024-05-02_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}